import{s as W,n as A,e as L,o as F}from"../chunks/scheduler.k-kUyWhY.js";import{S as G,i as J,e as N,a as w,f as p,g,s as U,h as v,j as S,x as V,c as D,k as C,y as d,z as K,m as P,n as x,A as Q,o as j}from"../chunks/index.r8EpClek.js";import{g as O}from"../chunks/navigation.QPO9O_54.js";import{c as T,a as I}from"../chunks/store.GyNWBc1a.js";function q(i){return i?.length!==void 0?i:Array.from(i)}function z(i,t,e){const n=i.slice();return n[6]=t[e],n}function B(i){let t,e,n,r="Welcome to Spring Pointing!",l,s,f,a="Start new Pointing Session",o,c,h;function k(_,b){return _[1]?X:R}let E=k(i),m=E(i),u=i[2]&&H(i);return{c(){t=g("div"),e=g("div"),n=g("h1"),n.textContent=r,l=U(),m.c(),s=U(),f=g("button"),f.textContent=a,o=U(),u&&u.c(),this.h()},l(_){t=v(_,"DIV",{class:!0});var b=S(t);e=v(b,"DIV",{class:!0});var y=S(e);n=v(y,"H1",{class:!0,"data-svelte-h":!0}),V(n)!=="svelte-gcb7u4"&&(n.textContent=r),l=D(y),m.l(y),s=D(y),f=v(y,"BUTTON",{class:!0,"data-svelte-h":!0}),V(f)!=="svelte-k8on3b"&&(f.textContent=a),o=D(y),u&&u.l(y),y.forEach(p),b.forEach(p),this.h()},h(){C(n,"class","text-3xl font-bold"),C(f,"class","bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"),C(e,"class","container mx-auto border border-1 p-2"),C(t,"class","bg-gray-900 text-white p-8 min-h-full flex flex-col flex-grow justify-center items-center")},m(_,b){w(_,t,b),d(t,e),d(e,n),d(e,l),m.m(e,null),d(e,s),d(e,f),d(e,o),u&&u.m(e,null),c||(h=K(f,"click",i[3]),c=!0)},p(_,b){E===(E=k(_))&&m?m.p(_,b):(m.d(1),m=E(_),m&&(m.c(),m.m(e,s))),_[2]?u?u.p(_,b):(u=H(_),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},d(_){_&&p(t),m.d(),u&&u.d(),c=!1,h()}}}function R(i){let t,e="Current display name: loading...";return{c(){t=g("p"),t.textContent=e},l(n){t=v(n,"P",{"data-svelte-h":!0}),V(t)!=="svelte-u9upty"&&(t.textContent=e)},m(n,r){w(n,t,r)},p:A,d(n){n&&p(t)}}}function X(i){let t,e,n=i[1].display_name+"",r;return{c(){t=g("p"),e=P("Current display name: "),r=P(n)},l(l){t=v(l,"P",{});var s=S(t);e=x(s,"Current display name: "),r=x(s,n),s.forEach(p)},m(l,s){w(l,t,s),d(t,e),d(t,r)},p(l,s){s&2&&n!==(n=l[1].display_name+"")&&j(r,n)},d(l){l&&p(t)}}}function H(i){let t,e,n,r=q(i[2]),l=[];for(let s=0;s<r.length;s+=1)l[s]=M(z(i,r,s));return{c(){t=g("div"),e=P(`Previous Sessions:
                `),n=g("ul");for(let s=0;s<l.length;s+=1)l[s].c()},l(s){t=v(s,"DIV",{});var f=S(t);e=x(f,`Previous Sessions:
                `),n=v(f,"UL",{});var a=S(n);for(let o=0;o<l.length;o+=1)l[o].l(a);a.forEach(p),f.forEach(p)},m(s,f){w(s,t,f),d(t,e),d(t,n);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(n,null)},p(s,f){if(f&4){r=q(s[2]);let a;for(a=0;a<r.length;a+=1){const o=z(s,r,a);l[a]?l[a].p(o,f):(l[a]=M(o),l[a].c(),l[a].m(n,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=r.length}},d(s){s&&p(t),Q(l,s)}}}function M(i){let t,e,n=i[6].id+"",r,l,s=i[6].last_updated+"",f,a,o;return{c(){t=g("li"),e=g("a"),r=P(n),l=P(" - "),f=P(s),o=U(),this.h()},l(c){t=v(c,"LI",{});var h=S(t);e=v(h,"A",{href:!0});var k=S(e);r=x(k,n),l=x(k," - "),f=x(k,s),k.forEach(p),o=D(h),h.forEach(p),this.h()},h(){C(e,"href",a="/points/"+i[6].id+"/")},m(c,h){w(c,t,h),d(t,e),d(e,r),d(e,l),d(e,f),d(t,o)},p(c,h){h&4&&n!==(n=c[6].id+"")&&j(r,n),h&4&&s!==(s=c[6].last_updated+"")&&j(f,s),h&4&&a!==(a="/points/"+c[6].id+"/")&&C(e,"href",a)},d(c){c&&p(t)}}}function Y(i){let t,e=i[0].session&&B(i);return{c(){e&&e.c(),t=N()},l(n){e&&e.l(n),t=N()},m(n,r){e&&e.m(n,r),w(n,t,r)},p(n,[r]){n[0].session?e?e.p(n,r):(e=B(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:A,o:A,d(n){n&&p(t),e&&e.d(n)}}}function Z(i,t,e){let n,r;L(i,I,o=>e(1,n=o)),L(i,T,o=>e(2,r=o));let{data:l}=t,{supabase:s}=l;async function f(){const{data2:o,error:c}=await s.from("PointingSession").insert({last_updated:new Date().toISOString(),player_data:{},users:l?.session.user.id}).select();console.log("started new session",o,c),o&&O(`/points/${c[0].id}`)}async function a(){s.from("PointingSession").select().then(o=>{T.set(o.data)}),s.from("profiles").select("*").limit(1).single().then(o=>{console.log("profile",o),o?.data?I.set(o.data):I.set({display_name:"default",temporary:!0})})}return F(async()=>{l.session||O("/auth")}),i.$$set=o=>{"data"in o&&e(0,l=o.data)},i.$$.update=()=>{i.$$.dirty&1&&({supabase:s}=l),i.$$.dirty&1&&l.session&&a()},[l,n,r,f]}class se extends G{constructor(t){super(),J(this,t,Z,Y,W,{data:0})}}export{se as component};
