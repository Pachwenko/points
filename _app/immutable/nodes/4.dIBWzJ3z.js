import{s as be,e as Y,i as w,z as Q,d as _,G as Ke,f as P,a as R,g as N,h as T,c as $,u as ge,j as b,k as E,v as j,C as ce,H as ot,B as pe,F as at,l as X,m as F,n as Z,I as rt,p as ft,A as Ie,o as ct,J as Te,E as ut,K as le}from"../chunks/scheduler.wCkDe2Ta.js";import{S as ye,i as ve,b as oe,d as ae,m as re,a as z,t as H,c as Pe,e as fe,g as Ne}from"../chunks/index.LId1ysqj.js";import{e as W,u as Qe,d as Ze,B as he,b as J,a as we}from"../chunks/button.kyY1xn4m.js";import{g as Oe}from"../chunks/navigation.sly37ktX.js";const dt=({params:n})=>({slug:n.slug}),Xt=Object.freeze(Object.defineProperty({__proto__:null,load:dt},Symbol.toStringTag,{value:"Module"}));function Ve(n,e,t){const l=n.slice();return l[8]=e[t],l}function De(n){let e,t,l,i,a="×",s,o,f="Pick your emoji!",y,g,r,d,h=W(n[1]),c=[];for(let m=0;m<h.length;m+=1)c[m]=Ce(Ve(n,h,m));return{c(){e=P("button"),t=R(),l=P("div"),i=P("button"),i.textContent=a,s=R(),o=P("span"),o.textContent=f,y=R(),g=P("div");for(let m=0;m<c.length;m+=1)c[m].c();this.h()},l(m){e=N(m,"BUTTON",{type:!0,class:!0,"aria-label":!0,style:!0}),T(e).forEach(_),t=$(m),l=N(m,"DIV",{class:!0,style:!0});var u=T(l);i=N(u,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),ge(i)!=="svelte-1o98il1"&&(i.textContent=a),s=$(u),o=N(u,"SPAN",{class:!0,"data-svelte-h":!0}),ge(o)!=="svelte-tn48hr"&&(o.textContent=f),y=$(u),g=N(u,"DIV",{class:!0});var v=T(g);for(let A=0;A<c.length;A+=1)c[A].l(v);v.forEach(_),u.forEach(_),this.h()},h(){b(e,"type","button"),b(e,"class","fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50"),b(e,"aria-label","Close emoji picker"),E(e,"all","unset"),E(e,"position","fixed"),E(e,"inset","0"),E(e,"z-index","50"),E(e,"display","flex"),E(e,"align-items","center"),E(e,"justify-content","center"),E(e,"background","rgba(0,0,0,0.7)"),b(i,"class","absolute top-2 right-2 text-orange-300 hover:text-orange-100 text-2xl font-bold"),b(i,"title","Close"),b(i,"aria-label","Close"),b(o,"class","mb-2 text-orange-200 font-bold text-lg"),b(g,"class","grid grid-cols-8 gap-2 max-w-xs"),b(l,"class","fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-yellow-900 border-4 border-yellow-700 rounded-xl shadow-2xl p-6 flex flex-col items-center min-w-[320px] max-w-[90vw] z-50"),E(l,"background-color","#282828")},m(m,u){w(m,e,u),w(m,t,u),w(m,l,u),j(l,i),j(l,s),j(l,o),j(l,y),j(l,g);for(let v=0;v<c.length;v+=1)c[v]&&c[v].m(g,null);r||(d=[ce(e,"click",n[3]),ce(i,"click",n[3]),ce(l,"click",ot(n[5]))],r=!0)},p(m,u){if(u&6){h=W(m[1]);let v;for(v=0;v<h.length;v+=1){const A=Ve(m,h,v);c[v]?c[v].p(A,u):(c[v]=Ce(A),c[v].c(),c[v].m(g,null))}for(;v<c.length;v+=1)c[v].d(1);c.length=h.length}},d(m){m&&(_(e),_(t),_(l)),pe(c,m),r=!1,at(d)}}}function Ce(n){let e,t=n[8]+"",l,i,a,s,o,f;function y(){return n[6](n[8])}return{c(){e=P("button"),l=X(t),i=R(),this.h()},l(g){e=N(g,"BUTTON",{type:!0,class:!0,title:!0,"aria-label":!0,tabindex:!0});var r=T(e);l=F(r,t),i=$(r),r.forEach(_),this.h()},h(){b(e,"type","button"),b(e,"class","text-2xl hover:scale-125 transition-transform duration-150 bg-yellow-800 hover:bg-yellow-700 rounded-full px-2 py-1 focus:outline-none focus:ring-2 focus:ring-orange-400"),b(e,"title",a=`Pick ${n[8]}`),b(e,"aria-label",s=`Pick ${n[8]}`),b(e,"tabindex","0")},m(g,r){w(g,e,r),j(e,l),j(e,i),o||(f=ce(e,"click",y),o=!0)},p(g,r){n=g,r&2&&t!==(t=n[8]+"")&&Z(l,t),r&2&&a!==(a=`Pick ${n[8]}`)&&b(e,"title",a),r&2&&s!==(s=`Pick ${n[8]}`)&&b(e,"aria-label",s)},d(g){g&&_(e),o=!1,f()}}}function mt(n){let e,t=n[0]&&De(n);return{c(){t&&t.c(),e=Y()},l(l){t&&t.l(l),e=Y()},m(l,i){t&&t.m(l,i),w(l,e,i)},p(l,[i]){l[0]?t?t.p(l,i):(t=De(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Q,o:Q,d(l){l&&_(e),t&&t.d(l)}}}function _t(n,e,t){let{show:l=!1}=e,{emojiOptions:i=[]}=e,{selectedEmoji:a=""}=e;const s=Ke();function o(r){s("pick",r)}function f(){s("close")}function y(r){rt.call(this,n,r)}const g=r=>o(r);return n.$$set=r=>{"show"in r&&t(0,l=r.show),"emojiOptions"in r&&t(1,i=r.emojiOptions),"selectedEmoji"in r&&t(4,a=r.selectedEmoji)},[l,i,o,f,a,y,g]}class ht extends ye{constructor(e){super(),ve(this,e,_t,mt,be,{show:0,emojiOptions:1,selectedEmoji:4})}}function Re(n,e,t){const l=n.slice();return l[10]=e[t],l[11]=e,l[12]=t,l}function $e(n){let e,t,l=n[10].displayName+"",i,a,s,o=n[10],f,y,g=((n[4]||n[10].id===n[2])&&n[10].currentVote||"—")+"",r,d,h,c,m,u,v,A;const L=()=>n[7](t,o),x=()=>n[7](null,o);function B(){return n[8](n[10])}let V=!n[4]&&n[10].currentVote&&Ae(),D=n[3][n[10].id]&&Ue(n);return{c(){e=P("li"),t=P("button"),i=X(l),f=X(`
				: `),y=P("span"),r=X(g),d=R(),V&&V.c(),h=R(),D&&D.c(),c=R(),this.h()},l(M){e=N(M,"LI",{class:!0,"data-test-id":!0});var S=T(e);t=N(S,"BUTTON",{class:!0,title:!0,"aria-label":!0,tabindex:!0});var O=T(t);i=F(O,l),O.forEach(_),f=F(S,`
				: `),y=N(S,"SPAN",{class:!0});var k=T(y);r=F(k,g),d=$(k),V&&V.l(k),k.forEach(_),h=$(S),D&&D.l(S),c=$(S),S.forEach(_),this.h()},h(){b(t,"class","underline cursor-pointer text-orange-300 hover:text-orange-200 transition-colors px-1 rounded focus:outline-none focus:ring-2 focus:ring-yellow-400"),b(t,"title",a=`Throw an emoji at ${n[10].displayName}!`),b(t,"aria-label",s=`Throw an emoji at ${n[10].displayName}`),b(t,"tabindex","0"),b(y,"class","text-aqua-200"),b(e,"class",m="text-lg flex items-center gap-2 mb-1 "+(n[10].id===n[2]?"font-bold text-lime-300":"")),b(e,"data-test-id",u=`user-${n[10].id}`)},m(M,S){w(M,e,S),j(e,t),j(t,i),L(),j(e,f),j(e,y),j(y,r),j(y,d),V&&V.m(y,null),j(e,h),D&&D.m(e,null),j(e,c),v||(A=ce(t,"click",B),v=!0)},p(M,S){n=M,S&2&&l!==(l=n[10].displayName+"")&&Z(i,l),S&2&&a!==(a=`Throw an emoji at ${n[10].displayName}!`)&&b(t,"title",a),S&2&&s!==(s=`Throw an emoji at ${n[10].displayName}`)&&b(t,"aria-label",s),o!==n[10]&&(x(),o=n[10],L()),S&22&&g!==(g=((n[4]||n[10].id===n[2])&&n[10].currentVote||"—")+"")&&Z(r,g),!n[4]&&n[10].currentVote?V||(V=Ae(),V.c(),V.m(y,null)):V&&(V.d(1),V=null),n[3][n[10].id]?D?D.p(n,S):(D=Ue(n),D.c(),D.m(e,c)):D&&(D.d(1),D=null),S&6&&m!==(m="text-lg flex items-center gap-2 mb-1 "+(n[10].id===n[2]?"font-bold text-lime-300":""))&&b(e,"class",m),S&2&&u!==(u=`user-${n[10].id}`)&&b(e,"data-test-id",u)},d(M){M&&_(e),x(),V&&V.d(),D&&D.d(),v=!1,A()}}}function Ae(n){let e;return{c(){e=P("span"),this.h()},l(t){e=N(t,"SPAN",{class:!0,title:!0}),T(e).forEach(_),this.h()},h(){b(e,"class","inline-block w-2 h-2 ml-2 rounded-full bg-lime-400 align-middle"),b(e,"title","Vote submitted")},m(t,l){w(t,e,l)},d(t){t&&_(e)}}}function Ue(n){let e,t=n[3][n[10].id]+"",l;return{c(){e=P("span"),l=X(t),this.h()},l(i){e=N(i,"SPAN",{class:!0});var a=T(e);l=F(a,t),a.forEach(_),this.h()},h(){b(e,"class","ml-2 animate-bounce text-2xl")},m(i,a){w(i,e,a),j(e,l)},p(i,a){a&10&&t!==(t=i[3][i[10].id]+"")&&Z(l,t)},d(i){i&&_(e)}}}function ze(n){let e,t=n[10]&&n[10].displayName&&$e(n);return{c(){t&&t.c(),e=Y()},l(l){t&&t.l(l),e=Y()},m(l,i){t&&t.m(l,i),w(l,e,i)},p(l,i){l[10]&&l[10].displayName?t?t.p(l,i):(t=$e(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){l&&_(e),t&&t.d(l)}}}function gt(n){let e,t=W(n[1]),l=[];for(let i=0;i<t.length;i+=1)l[i]=ze(Re(n,t,i));return{c(){e=P("ol");for(let i=0;i<l.length;i+=1)l[i].c()},l(i){e=N(i,"OL",{});var a=T(e);for(let s=0;s<l.length;s+=1)l[s].l(a);a.forEach(_)},m(i,a){w(i,e,a);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(i,[a]){if(a&63){t=W(i[1]);let s;for(s=0;s<t.length;s+=1){const o=Re(i,t,s);l[s]?l[s].p(o,a):(l[s]=ze(o),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=t.length}},i:Q,o:Q,d(i){i&&_(e),pe(l,i)}}}function pt(n,e,t){let{players:l=[]}=e,{sessionUserId:i=""}=e,{thrownEmojis:a={}}=e,{selectedEmoji:s=""}=e,{playerRefs:o={}}=e,{votesRevealed:f=!1}=e;const y=Ke();function g(h){y("throw",{emoji:s,playerId:h})}function r(h,c){ft[h?"unshift":"push"](()=>{o[c.id]=h,t(0,o)})}const d=h=>g(h.id);return n.$$set=h=>{"players"in h&&t(1,l=h.players),"sessionUserId"in h&&t(2,i=h.sessionUserId),"thrownEmojis"in h&&t(3,a=h.thrownEmojis),"selectedEmoji"in h&&t(6,s=h.selectedEmoji),"playerRefs"in h&&t(0,o=h.playerRefs),"votesRevealed"in h&&t(4,f=h.votesRevealed)},[o,l,i,a,f,g,s,r,d]}class bt extends ye{constructor(e){super(),ve(this,e,pt,gt,be,{players:1,sessionUserId:2,thrownEmojis:3,selectedEmoji:6,playerRefs:0,votesRevealed:4})}}function Ye(n,e,t){const l=n.slice();return l[1]=e[t],l}function yt(n){let e,t=n[1].emoji+"",l,i,a;return{c(){e=P("span"),l=X(t),i=R(),this.h()},l(s){e=N(s,"SPAN",{class:!0,style:!0});var o=T(e);l=F(o,t),i=$(o),o.forEach(_),this.h()},h(){b(e,"class",a="fly-emoji select-none "+(n[1].flying?"flying":"")+" svelte-t5z84b"),E(e,"left","0"),E(e,"top","0"),E(e,"transform","translate("+(n[1].flying?n[1].xStart:n[1].endX)+"px, "+(n[1].flying?n[1].yStart:n[1].endY)+"px) "+(n[1].flying?"scale(1.5) rotate(-20deg)":"scale(1) rotate(0deg)")),E(e,"opacity",n[1].flying?.8:1),E(e,"--fly-duration","0.9s")},m(s,o){w(s,e,o),j(e,l),j(e,i)},p(s,o){o&1&&t!==(t=s[1].emoji+"")&&Z(l,t),o&1&&a!==(a="fly-emoji select-none "+(s[1].flying?"flying":"")+" svelte-t5z84b")&&b(e,"class",a),o&1&&E(e,"transform","translate("+(s[1].flying?s[1].xStart:s[1].endX)+"px, "+(s[1].flying?s[1].yStart:s[1].endY)+"px) "+(s[1].flying?"scale(1.5) rotate(-20deg)":"scale(1) rotate(0deg)")),o&1&&E(e,"opacity",s[1].flying?.8:1)},d(s){s&&_(e)}}}function vt(n){let e,t,l=n[1].emoji+"",i,a;return{c(){e=P("span"),t=P("span"),i=X(l),a=R(),this.h()},l(s){e=N(s,"SPAN",{style:!0});var o=T(e);t=N(o,"SPAN",{class:!0,style:!0});var f=T(t);i=F(f,l),f.forEach(_),a=$(o),o.forEach(_),this.h()},h(){b(t,"class","fly-emoji select-none emoji-bounce svelte-t5z84b"),E(t,"font-size","2.5rem"),E(e,"position","fixed"),E(e,"left",n[1].endX+"px"),E(e,"top",n[1].endY+"px"),E(e,"z-index","100")},m(s,o){w(s,e,o),j(e,t),j(t,i),j(e,a)},p(s,o){o&1&&l!==(l=s[1].emoji+"")&&Z(i,l),o&1&&E(e,"left",s[1].endX+"px"),o&1&&E(e,"top",s[1].endY+"px")},d(s){s&&_(e)}}}function Xe(n,e){let t,l;function i(o,f){return o[1].bouncing?vt:yt}let a=i(e),s=a(e);return{key:n,first:null,c(){t=Y(),s.c(),l=Y(),this.h()},l(o){t=Y(),s.l(o),l=Y(),this.h()},h(){this.first=t},m(o,f){w(o,t,f),s.m(o,f),w(o,l,f)},p(o,f){e=o,a===(a=i(e))&&s?s.p(e,f):(s.d(1),s=a(e),s&&(s.c(),s.m(l.parentNode,l)))},d(o){o&&(_(t),_(l)),s.d(o)}}}function kt(n){let e=[],t=new Map,l,i=W(n[0]);const a=s=>s[1].id;for(let s=0;s<i.length;s+=1){let o=Ye(n,i,s),f=a(o);t.set(f,e[s]=Xe(f,o))}return{c(){for(let s=0;s<e.length;s+=1)e[s].c();l=Y()},l(s){for(let o=0;o<e.length;o+=1)e[o].l(s);l=Y()},m(s,o){for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(s,o);w(s,l,o)},p(s,[o]){o&1&&(i=W(s[0]),e=Qe(e,o,a,1,s,i,t,l.parentNode,Ze,Xe,l,Ye))},i:Q,o:Q,d(s){s&&_(l);for(let o=0;o<e.length;o+=1)e[o].d(s)}}}function jt(n,e,t){let{flyingEmojis:l=[]}=e;return n.$$set=i=>{"flyingEmojis"in i&&t(0,l=i.flyingEmojis)},[l]}class Et extends ye{constructor(e){super(),ve(this,e,jt,kt,be,{flyingEmojis:0})}}function Fe(n,e,t){const l=n.slice();return l[38]=e[t],l}function Le(n,e,t){const l=n.slice();return l[41]=e[t],l}function Me(n,e,t){const l=n.slice();return l[44]=e[t],l}function qe(n){let e,t,l,i,a,s,o="Player Votes",f,y,g,r,d,h,c,m,u,v,A,L,x,B,V;function D(k,I){return k[10]?St:wt}let M=D(n),S=M(n);y=new bt({props:{players:n[2],sessionUserId:n[0].session.user.id,thrownEmojis:n[6],selectedEmoji:n[9],playerRefs:n[1],votesRevealed:n[3]?.game_state?.votesRevealed}}),y.$on("throw",n[24]);let O=n[3]?.game_state&&Be(n);return c=new he({props:{variant:"default",$$slots:{default:[Nt]},$$scope:{ctx:n}}}),c.$on("click",n[27]),u=new he({props:{variant:"default",$$slots:{default:[It]},$$scope:{ctx:n}}}),u.$on("click",n[28]),L=new he({props:{class:"px-4 py-2 bg-orange-700 text-white rounded-lg hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-400",$$slots:{default:[Tt]},$$scope:{ctx:n}}}),L.$on("click",n[18]),B=new ht({props:{show:n[8],emojiOptions:n[12],selectedEmoji:n[9]}}),B.$on("close",n[19]),B.$on("pick",n[29]),{c(){e=P("div"),t=P("div"),S.c(),l=R(),i=P("div"),a=P("div"),s=P("h3"),s.textContent=o,f=R(),oe(y.$$.fragment),g=R(),r=P("div"),O&&O.c(),d=R(),h=P("div"),oe(c.$$.fragment),m=R(),oe(u.$$.fragment),v=R(),A=P("div"),oe(L.$$.fragment),x=R(),oe(B.$$.fragment),this.h()},l(k){e=N(k,"DIV",{class:!0});var I=T(e);t=N(I,"DIV",{class:!0});var U=T(t);S.l(U),l=$(U),i=N(U,"DIV",{class:!0});var G=T(i);a=N(G,"DIV",{class:!0});var ee=T(a);s=N(ee,"H3",{class:!0,"data-svelte-h":!0}),ge(s)!=="svelte-1vfpxjc"&&(s.textContent=o),f=$(ee),ae(y.$$.fragment,ee),ee.forEach(_),g=$(G),r=N(G,"DIV",{});var ne=T(r);O&&O.l(ne),ne.forEach(_),d=$(G),h=N(G,"DIV",{class:!0});var K=T(h);ae(c.$$.fragment,K),m=$(K),ae(u.$$.fragment,K),K.forEach(_),G.forEach(_),v=$(U),A=N(U,"DIV",{class:!0});var ue=T(A);ae(L.$$.fragment,ue),ue.forEach(_),x=$(U),ae(B.$$.fragment,U),U.forEach(_),I.forEach(_),this.h()},h(){b(s,"class","font-bold text-2xl mb-2"),b(a,"class","flex flex-col items-start gap-2"),b(h,"class","flex flex-col gap-2 items-stretch ml-8"),b(i,"class","grid grid-cols-3"),b(A,"class","mt-4 flex flex-col items-center"),b(t,"class","container mx-auto p-2 text-center"),b(e,"class","p-8 min-h-full flex flex-col flex-grow justify-center items-center")},m(k,I){w(k,e,I),j(e,t),S.m(t,null),j(t,l),j(t,i),j(i,a),j(a,s),j(a,f),re(y,a,null),j(i,g),j(i,r),O&&O.m(r,null),j(i,d),j(i,h),re(c,h,null),j(h,m),re(u,h,null),j(t,v),j(t,A),re(L,A,null),j(t,x),re(B,t,null),V=!0},p(k,I){M!==(M=D(k))&&(S.d(1),S=M(k),S&&(S.c(),S.m(t,l)));const U={};I[0]&4&&(U.players=k[2]),I[0]&1&&(U.sessionUserId=k[0].session.user.id),I[0]&64&&(U.thrownEmojis=k[6]),I[0]&512&&(U.selectedEmoji=k[9]),I[0]&2&&(U.playerRefs=k[1]),I[0]&8&&(U.votesRevealed=k[3]?.game_state?.votesRevealed),y.$set(U),k[3]?.game_state?O?(O.p(k,I),I[0]&8&&z(O,1)):(O=Be(k),O.c(),z(O,1),O.m(r,null)):O&&(Ne(),H(O,1,1,()=>{O=null}),Pe());const G={};I[1]&65536&&(G.$$scope={dirty:I,ctx:k}),c.$set(G);const ee={};I[1]&65536&&(ee.$$scope={dirty:I,ctx:k}),u.$set(ee);const ne={};I[0]&512|I[1]&65536&&(ne.$$scope={dirty:I,ctx:k}),L.$set(ne);const K={};I[0]&256&&(K.show=k[8]),I[0]&512&&(K.selectedEmoji=k[9]),B.$set(K)},i(k){V||(z(y.$$.fragment,k),z(O),z(c.$$.fragment,k),z(u.$$.fragment,k),z(L.$$.fragment,k),z(B.$$.fragment,k),V=!0)},o(k){H(y.$$.fragment,k),H(O),H(c.$$.fragment,k),H(u.$$.fragment,k),H(L.$$.fragment,k),H(B.$$.fragment,k),V=!1},d(k){k&&_(e),S.d(),fe(y),O&&O.d(),fe(c),fe(u),fe(L),fe(B)}}}function wt(n){let e,t="Display name: loading...";return{c(){e=P("div"),e.textContent=t},l(l){e=N(l,"DIV",{"data-svelte-h":!0}),ge(e)!=="svelte-1ar43gj"&&(e.textContent=t)},m(l,i){w(l,e,i)},d(l){l&&_(e)}}}function St(n){return{c:Q,l:Q,m:Q,d:Q}}function Be(n){let e,t,l,i,a,s,o,f,y=W(n[11]),g=[];for(let c=0;c<y.length;c+=1)g[c]=Je(Me(n,y,c));let r=W(n[4]),d=[];for(let c=0;c<r.length;c+=1)d[c]=He(Le(n,r,c));const h=c=>H(d[c],1,1,()=>{d[c]=null});return{c(){e=X(`Select your pointing system:
						`),t=P("select");for(let c=0;c<g.length;c+=1)g[c].c();i=R(),a=P("div");for(let c=0;c<d.length;c+=1)d[c].c();this.h()},l(c){e=F(c,`Select your pointing system:
						`),t=N(c,"SELECT",{class:!0});var m=T(t);for(let v=0;v<g.length;v+=1)g[v].l(m);m.forEach(_),i=$(c),a=N(c,"DIV",{class:!0});var u=T(a);for(let v=0;v<d.length;v+=1)d[v].l(u);u.forEach(_),this.h()},h(){b(t,"class","mb-4 px-4 py-2 rounded border-4 border-[#fe8019] bg-[#282828] text-[#ebdbb2] font-bold focus:outline-none focus:ring-2 focus:ring-[#fe8019] transition-all duration-150"),b(a,"class","flex gap-3 mt-2")},m(c,m){w(c,e,m),w(c,t,m);for(let u=0;u<g.length;u+=1)g[u]&&g[u].m(t,null);Te(t,n[3].game_state.pointingSystem),w(c,i,m),w(c,a,m);for(let u=0;u<d.length;u+=1)d[u]&&d[u].m(a,null);s=!0,o||(f=ce(t,"change",n[25]),o=!0)},p(c,m){if(m[0]&2048){y=W(c[11]);let u;for(u=0;u<y.length;u+=1){const v=Me(c,y,u);g[u]?g[u].p(v,m):(g[u]=Je(v),g[u].c(),g[u].m(t,null))}for(;u<g.length;u+=1)g[u].d(1);g.length=y.length}if((!s||m[0]&2056&&l!==(l=c[3].game_state.pointingSystem))&&Te(t,c[3].game_state.pointingSystem),m[0]&16432){r=W(c[4]);let u;for(u=0;u<r.length;u+=1){const v=Le(c,r,u);d[u]?(d[u].p(v,m),z(d[u],1)):(d[u]=He(v),d[u].c(),z(d[u],1),d[u].m(a,null))}for(Ne(),u=r.length;u<d.length;u+=1)h(u);Pe()}},i(c){if(!s){for(let m=0;m<r.length;m+=1)z(d[m]);s=!0}},o(c){d=d.filter(Boolean);for(let m=0;m<d.length;m+=1)H(d[m]);s=!1},d(c){c&&(_(e),_(t),_(i),_(a)),pe(g,c),pe(d,c),o=!1,f()}}}function Je(n){let e,t=n[44]+"",l;return{c(){e=P("option"),l=X(t),this.h()},l(i){e=N(i,"OPTION",{});var a=T(e);l=F(a,t),a.forEach(_),this.h()},h(){e.__value=n[44],ut(e,e.__value)},m(i,a){w(i,e,a),j(e,l)},p:Q,d(i){i&&_(e)}}}function Pt(n){let e=n[41]+"",t;return{c(){t=X(e)},l(l){t=F(l,e)},m(l,i){w(l,t,i)},p(l,i){i[0]&16&&e!==(e=l[41]+"")&&Z(t,e)},d(l){l&&_(t)}}}function He(n){let e,t;function l(){return n[26](n[41])}return e=new he({props:{"aria-current":n[5]===n[41],"aria-label":n[41],selected:n[5]===n[41],variant:"number",$$slots:{default:[Pt]},$$scope:{ctx:n}}}),e.$on("click",l),{c(){oe(e.$$.fragment)},l(i){ae(e.$$.fragment,i)},m(i,a){re(e,i,a),t=!0},p(i,a){n=i;const s={};a[0]&48&&(s["aria-current"]=n[5]===n[41]),a[0]&16&&(s["aria-label"]=n[41]),a[0]&48&&(s.selected=n[5]===n[41]),a[0]&16|a[1]&65536&&(s.$$scope={dirty:a,ctx:n}),e.$set(s)},i(i){t||(z(e.$$.fragment,i),t=!0)},o(i){H(e.$$.fragment,i),t=!1},d(i){fe(e,i)}}}function Nt(n){let e;return{c(){e=X("Clear Votes")},l(t){e=F(t,"Clear Votes")},m(t,l){w(t,e,l)},d(t){t&&_(e)}}}function It(n){let e;return{c(){e=X("Show Votes")},l(t){e=F(t,"Show Votes")},m(t,l){w(t,e,l)},d(t){t&&_(e)}}}function Tt(n){let e,t,l;return{c(){e=X(`Pick Emoji
					`),t=P("span"),l=X(n[9]),this.h()},l(i){e=F(i,`Pick Emoji
					`),t=N(i,"SPAN",{class:!0});var a=T(t);l=F(a,n[9]),a.forEach(_),this.h()},h(){b(t,"class","ml-2 text-2xl")},m(i,a){w(i,e,a),w(i,t,a),j(t,l)},p(i,a){a[0]&512&&Z(l,i[9])},d(i){i&&(_(e),_(t))}}}function Ot(n){let e,t=n[38].emoji+"",l,i,a;return{c(){e=P("span"),l=X(t),i=R(),this.h()},l(s){e=N(s,"SPAN",{class:!0,style:!0});var o=T(e);l=F(o,t),i=$(o),o.forEach(_),this.h()},h(){b(e,"class",a="fly-emoji select-none "+(n[38].flying?"flying":"")+" svelte-1dknjrm"),E(e,"left","0"),E(e,"top","0"),E(e,"transform","translate("+(n[38].flying?n[38].xStart:n[38].endX)+"px, "+(n[38].flying?n[38].yStart:n[38].endY)+"px) "+(n[38].flying?"scale(1.5) rotate(-20deg)":"scale(1) rotate(0deg)")),E(e,"opacity",n[38].flying?.8:1),E(e,"--fly-duration",Se+"s")},m(s,o){w(s,e,o),j(e,l),j(e,i)},p(s,o){o[0]&128&&t!==(t=s[38].emoji+"")&&Z(l,t),o[0]&128&&a!==(a="fly-emoji select-none "+(s[38].flying?"flying":"")+" svelte-1dknjrm")&&b(e,"class",a),o[0]&128&&E(e,"transform","translate("+(s[38].flying?s[38].xStart:s[38].endX)+"px, "+(s[38].flying?s[38].yStart:s[38].endY)+"px) "+(s[38].flying?"scale(1.5) rotate(-20deg)":"scale(1) rotate(0deg)")),o[0]&128&&E(e,"opacity",s[38].flying?.8:1)},d(s){s&&_(e)}}}function Vt(n){let e,t,l=n[38].emoji+"",i,a;return{c(){e=P("span"),t=P("span"),i=X(l),a=R(),this.h()},l(s){e=N(s,"SPAN",{style:!0});var o=T(e);t=N(o,"SPAN",{class:!0,style:!0});var f=T(t);i=F(f,l),f.forEach(_),a=$(o),o.forEach(_),this.h()},h(){b(t,"class","fly-emoji select-none emoji-bounce svelte-1dknjrm"),E(t,"font-size","2.5rem"),E(e,"position","fixed"),E(e,"left",n[38].endX+"px"),E(e,"top",n[38].endY+"px"),E(e,"z-index","100")},m(s,o){w(s,e,o),j(e,t),j(t,i),j(e,a)},p(s,o){o[0]&128&&l!==(l=s[38].emoji+"")&&Z(i,l),o[0]&128&&E(e,"left",s[38].endX+"px"),o[0]&128&&E(e,"top",s[38].endY+"px")},d(s){s&&_(e)}}}function Ge(n,e){let t,l;function i(o,f){return o[38].bouncing?Vt:Ot}let a=i(e),s=a(e);return{key:n,first:null,c(){t=Y(),s.c(),l=Y(),this.h()},l(o){t=Y(),s.l(o),l=Y(),this.h()},h(){this.first=t},m(o,f){w(o,t,f),s.m(o,f),w(o,l,f)},p(o,f){e=o,a===(a=i(e))&&s?s.p(e,f):(s.d(1),s=a(e),s&&(s.c(),s.m(l.parentNode,l)))},d(o){o&&(_(t),_(l)),s.d(o)}}}function Dt(n){let e,t,l,i=[],a=new Map,s,o,f=n[0].session&&qe(n);t=new Et({props:{flyingEmojis:n[7]}});let y=W(n[7]);const g=r=>r[38].id;for(let r=0;r<y.length;r+=1){let d=Fe(n,y,r),h=g(d);a.set(h,i[r]=Ge(h,d))}return{c(){f&&f.c(),e=R(),oe(t.$$.fragment),l=R();for(let r=0;r<i.length;r+=1)i[r].c();s=Y()},l(r){f&&f.l(r),e=$(r),ae(t.$$.fragment,r),l=$(r);for(let d=0;d<i.length;d+=1)i[d].l(r);s=Y()},m(r,d){f&&f.m(r,d),w(r,e,d),re(t,r,d),w(r,l,d);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(r,d);w(r,s,d),o=!0},p(r,d){r[0].session?f?(f.p(r,d),d[0]&1&&z(f,1)):(f=qe(r),f.c(),z(f,1),f.m(e.parentNode,e)):f&&(Ne(),H(f,1,1,()=>{f=null}),Pe());const h={};d[0]&128&&(h.flyingEmojis=r[7]),t.$set(h),d[0]&128&&(y=W(r[7]),i=Qe(i,d,g,1,r,y,a,s.parentNode,Ze,Ge,s,Fe))},i(r){o||(z(f),z(t.$$.fragment,r),o=!0)},o(r){H(f),H(t.$$.fragment,r),o=!1},d(r){r&&(_(e),_(l),_(s)),f&&f.d(r),fe(t,r);for(let d=0;d<i.length;d+=1)i[d].d(r)}}}const Ct=.3,Rt=.25,Se=.9;function We(){return new Date().toISOString()}function $t(n,e,t){let l,i;Ie(n,J,p=>t(3,l=p)),Ie(n,we,p=>t(10,i=p));let{data:a}=e,{supabase:s,session:o}=a,f,y=[];const g=["Fibonacci","T-Shirt Sizes"];let r,d=null,h={};const c=["🍅","😂","🎉","🔥","👏","😱","🥳","💩"];let m=[],u={};const v=-8;let A=!1,L=c[0];function x(p){l?.game_state&&(le(J,l.game_state.pointingSystem=p,l),le(J,l.game_state.last_updated=We(),l),S())}async function B(p){console.debug("syncPointingSession",p),J.set(p.new)}async function V(p){t(5,r=p),le(J,l.game_state.activePlayers[o.user.id].currentVote=r,l),le(J,l.game_state.activePlayers[o.user.id].displayName=i.display_name,l),le(J,l.game_state.last_updated=We(),l),await S()}async function D(){t(5,r=""),Object.entries(l.game_state.activePlayers).forEach(([p,C])=>(C.currentVote="",C)),le(J,l.game_state.votesRevealed=!1,l),await S()}async function M(){le(J,l.game_state.votesRevealed=!0,l),await S()}async function S(){await s.from("PointingSession").update({game_state:l.game_state,last_updated:l.last_updated}).eq("id",l.id).select().single().then(p=>{p.data&&(J.set(p.data),console.log("synced game state",p),f&&f.send({type:"broadcast",event:"refresh-session",payload:{from:o.user.id,timestamp:Date.now()}})),p.error&&console.error("error updating game state",p.error)})}async function O(){let p=!1,C=0;for(;!p&&C<5;){C++;const{data:q,error:de}=await s.from("PointingSession").select("*").eq("id",a.slug).single();if(!q||de)return;const se={...q.game_state?.activePlayers||{}};se[o.user.id]={currentVote:"",id:o.user.id,displayName:i.display_name};let ie=Array.isArray(q.users)?[...q.users]:[];ie.includes(o.user.id)||ie.push(o.user.id);const me=new Date().toISOString(),{error:ke,data:je}=await s.from("PointingSession").update({game_state:{...q.game_state,activePlayers:se},users:ie,last_updated:me}).eq("id",a.slug).eq("last_updated",q.last_updated).select().single();ke?await new Promise(Ee=>setTimeout(Ee,100*C)):(p=!0,J.set({...q,game_state:{...q.game_state,activePlayers:se},users:ie,last_updated:me}),f&&f.send({type:"broadcast",event:"refresh-session",payload:{from:o.user.id,timestamp:Date.now()}}))}}async function k(){await s.from("profiles").select("*").eq("id",o.user.id).limit(1).single().then(C=>{C?.data?we.set(C.data):we.set({display_name:"default",temporary:!0})}),await O();const{data:p}=await s.from("PointingSession").select("*").eq("id",a.slug).single();p&&t(23,f=s.channel(`${a.slug}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"PointingSession",filter:`id=eq.${p.id}`},C=>B(C)).subscribe())}let I=[];function U(p,C=null){const q=C||d;q&&(f&&f.send({type:"broadcast",event:"emoji-throw",payload:{from:o.user.id,to:q,emoji:p,timestamp:Date.now()}}),G({from:o.user.id,to:q,emoji:p}),d=null)}function G({from:p,to:C,emoji:q}){const de=u[C];if(!de)return;const se=de.getBoundingClientRect(),ie=se.left+se.width/2,me=se.top+se.height/2+v,ke=window.innerWidth,je=window.innerHeight,Ee=ie+ke*Ct,st=(Math.random()-.5)*(je*Rt),it=je/2+st,_e=Math.random().toString(36).slice(2);t(7,m=[...m,{emoji:q,userId:C,id:_e,xStart:Ee,yStart:it,endX:ie,endY:me,flying:!0,bouncing:!1}]),setTimeout(()=>{t(7,m=m.map(te=>te.id===_e?{...te,flying:!1}:te))},10),setTimeout(()=>{t(7,m=m.map(te=>te.id===_e?{...te,bouncing:!0}:te)),t(6,h={...h,[C]:q}),setTimeout(()=>{t(6,h={...h,[C]:null})},2e3)},Se*1e3),setTimeout(()=>{t(7,m=m.filter(te=>te.id!==_e))},(Se+.6)*1e3)}function ee(){t(8,A=!0)}function ne(){t(8,A=!1)}function K(p){t(9,L=p),ne()}ct(async()=>{a.slug||Oe("/"),o||(console.log("not loggin in, session:",o),Oe(`/auth?next=${location}`))});const ue=p=>U(p.detail.emoji,p.detail.playerId),xe=p=>x(p.target.value),et=p=>V(p),tt=()=>D(),lt=()=>M(),nt=p=>K(p.detail);return n.$$set=p=>{"data"in p&&t(0,a=p.data)},n.$$.update=()=>{if(n.$$.dirty[0]&1&&t(21,{supabase:s,session:o}=a,s,(t(22,o),t(0,a))),n.$$.dirty[0]&8&&l&&!l.game_state&&le(J,l.game_state={},l),n.$$.dirty[0]&8&&l?.game_state&&!l.game_state.pointingSystem&&(le(J,l.game_state.pointingSystem=g[0],l),S()),n.$$.dirty[0]&8&&l?.game_state?.pointingSystem&&t(4,y={Fibonacci:{name:"Fibonacci",numbers:[1,2,3,5,8]},"T-Shirt Sizes":{name:"T-Shirt Sizes",numbers:["XS","S","M","L","XL"]}}[l.game_state.pointingSystem]?.numbers||[]),n.$$.dirty[0]&4194304&&o&&k(),n.$$.dirty[0]&8&&l&&l?.game_state?.activePlayers&&t(2,I=Object.values(l.game_state.activePlayers)),n.$$.dirty[0]&10485761&&f&&(f.on("broadcast",{event:"emoji-throw"},p=>{p?.payload&&G(p.payload)}),f.on("broadcast",{event:"refresh-session"},async p=>{const{data:C}=await s.from("PointingSession").select("*").eq("id",a.slug).single();C&&J.set(C)})),n.$$.dirty[0]&6)for(const p of I)u[p.id]||t(1,u[p.id]=null,u)},[a,u,I,l,y,r,h,m,A,L,i,g,c,x,V,D,M,U,ee,ne,K,s,o,f,ue,xe,et,tt,lt,nt]}class Ft extends ye{constructor(e){super(),ve(this,e,$t,Dt,be,{data:0},null,[-1,-1])}}export{Ft as component,Xt as universal};
