import{s as W,n as V,e as j,o as F}from"../chunks/scheduler.Z_PGJaWH.js";import{S as G,i as J,e as A,a as E,f as p,g as v,s as U,h as g,j as C,x as q,c as D,k as P,y as u,z as K,m as S,n as x,A as Q,o as N}from"../chunks/index.i8b6seFL.js";import{e as L,c as O,a as w}from"../chunks/store.hw7zZTON.js";import{g as T}from"../chunks/navigation.HTgVpVhm.js";function z(r,t,e){const s=r.slice();return s[6]=t[e],s}function B(r){let t,e,s,o="Welcome to Spring Pointing!",n,l,c,a="Start new Pointing Session",i,_,h;function k(d,b){return d[1]?X:R}let I=k(r),m=I(r),f=r[2]&&H(r);return{c(){t=v("div"),e=v("div"),s=v("h1"),s.textContent=o,n=U(),m.c(),l=U(),c=v("button"),c.textContent=a,i=U(),f&&f.c(),this.h()},l(d){t=g(d,"DIV",{class:!0});var b=C(t);e=g(b,"DIV",{class:!0});var y=C(e);s=g(y,"H1",{class:!0,"data-svelte-h":!0}),q(s)!=="svelte-gcb7u4"&&(s.textContent=o),n=D(y),m.l(y),l=D(y),c=g(y,"BUTTON",{class:!0,"data-svelte-h":!0}),q(c)!=="svelte-1oq9o6h"&&(c.textContent=a),i=D(y),f&&f.l(y),y.forEach(p),b.forEach(p),this.h()},h(){P(s,"class","text-3xl font-bold"),P(c,"class","bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"),P(e,"class","container mx-auto border border-1 p-2"),P(t,"class","bg-gray-900 text-white p-8 min-h-full flex flex-col flex-grow justify-center items-center")},m(d,b){E(d,t,b),u(t,e),u(e,s),u(e,n),m.m(e,null),u(e,l),u(e,c),u(e,i),f&&f.m(e,null),_||(h=K(c,"click",r[3]),_=!0)},p(d,b){I===(I=k(d))&&m?m.p(d,b):(m.d(1),m=I(d),m&&(m.c(),m.m(e,l))),d[2]?f?f.p(d,b):(f=H(d),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(d){d&&p(t),m.d(),f&&f.d(),_=!1,h()}}}function R(r){let t,e="Current display name: loading...";return{c(){t=v("p"),t.textContent=e},l(s){t=g(s,"P",{"data-svelte-h":!0}),q(t)!=="svelte-u9upty"&&(t.textContent=e)},m(s,o){E(s,t,o)},p:V,d(s){s&&p(t)}}}function X(r){let t,e,s=r[1].display_name+"",o;return{c(){t=v("p"),e=S("Current display name: "),o=S(s)},l(n){t=g(n,"P",{});var l=C(t);e=x(l,"Current display name: "),o=x(l,s),l.forEach(p)},m(n,l){E(n,t,l),u(t,e),u(t,o)},p(n,l){l&2&&s!==(s=n[1].display_name+"")&&N(o,s)},d(n){n&&p(t)}}}function H(r){let t,e,s,o=L(r[2]),n=[];for(let l=0;l<o.length;l+=1)n[l]=M(z(r,o,l));return{c(){t=v("div"),e=S(`Previous Sessions:
					`),s=v("ul");for(let l=0;l<n.length;l+=1)n[l].c()},l(l){t=g(l,"DIV",{});var c=C(t);e=x(c,`Previous Sessions:
					`),s=g(c,"UL",{});var a=C(s);for(let i=0;i<n.length;i+=1)n[i].l(a);a.forEach(p),c.forEach(p)},m(l,c){E(l,t,c),u(t,e),u(t,s);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(s,null)},p(l,c){if(c&4){o=L(l[2]);let a;for(a=0;a<o.length;a+=1){const i=z(l,o,a);n[a]?n[a].p(i,c):(n[a]=M(i),n[a].c(),n[a].m(s,null))}for(;a<n.length;a+=1)n[a].d(1);n.length=o.length}},d(l){l&&p(t),Q(n,l)}}}function M(r){let t,e,s=r[6].id+"",o,n,l=r[6].last_updated+"",c,a,i;return{c(){t=v("li"),e=v("a"),o=S(s),n=S(" - "),c=S(l),i=U(),this.h()},l(_){t=g(_,"LI",{});var h=C(t);e=g(h,"A",{href:!0});var k=C(e);o=x(k,s),n=x(k," - "),c=x(k,l),k.forEach(p),i=D(h),h.forEach(p),this.h()},h(){P(e,"href",a="/points/"+r[6].id+"/")},m(_,h){E(_,t,h),u(t,e),u(e,o),u(e,n),u(e,c),u(t,i)},p(_,h){h&4&&s!==(s=_[6].id+"")&&N(o,s),h&4&&l!==(l=_[6].last_updated+"")&&N(c,l),h&4&&a!==(a="/points/"+_[6].id+"/")&&P(e,"href",a)},d(_){_&&p(t)}}}function Y(r){let t,e=r[0].session&&B(r);return{c(){e&&e.c(),t=A()},l(s){e&&e.l(s),t=A()},m(s,o){e&&e.m(s,o),E(s,t,o)},p(s,[o]){s[0].session?e?e.p(s,o):(e=B(s),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:V,o:V,d(s){s&&p(t),e&&e.d(s)}}}function Z(r,t,e){let s,o;j(r,w,i=>e(1,s=i)),j(r,O,i=>e(2,o=i));let{data:n}=t,{supabase:l}=n;async function c(){n.session.user.id,l.from("PointingSession").insert({last_updated:new Date().toISOString(),game_state:{version:1,activePlayers:{userId:{id:n.session.user.id,displayName:s.display_name,currentVote:""}}},users:[n.session.user.id]}).select().single().then(i=>{console.log("started new session",i),i.data&&T(`/points/${i.data.id}`)})}async function a(){l.from("PointingSession").select().contains("users",[n.session?.user.id]).then(i=>{O.set(i.data)}),l.from("profiles").select("*").eq("id",n.session?.user.id).limit(1).single().then(i=>{console.log("profile",i),i?.data?w.set(i.data):w.set({display_name:"default",temporary:!0})})}return F(async()=>{n.session||T("/auth")}),r.$$set=i=>{"data"in i&&e(0,n=i.data)},r.$$.update=()=>{r.$$.dirty&1&&({supabase:l}=n),r.$$.dirty&1&&n.session&&a()},[n,s,o,c]}class ne extends G{constructor(t){super(),J(this,t,Z,Y,W,{data:0})}}export{ne as component};
