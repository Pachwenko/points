import{s as ie,n as W,e as X,o as oe,k as M}from"../chunks/scheduler.qjSdMX96.js";import{S as ce,i as ue,g as y,h as k,j as E,f as h,k as P,a as U,s as H,m as S,x as fe,c as z,n as w,y as d,B as J,e as Y,A as se,o as A}from"../chunks/index.Asz5LQEO.js";import{e as B,b as j,a as K}from"../chunks/store.674mkOx1.js";import{g as Z}from"../chunks/navigation.Om4PnJII.js";const _e=({params:a})=>({slug:a.slug}),ke=Object.freeze(Object.defineProperty({__proto__:null,load:_e},Symbol.toStringTag,{value:"Module"}));function $(a,e,t){const l=a.slice();return l[17]=e[t],l}function x(a,e,t){const l=a.slice();return l[20]=e[t],l}function ee(a,e,t){const l=a.slice();return l[23]=e[t],l}function te(a){let e,t,l,i,s,f="Player Votes",o,u,b,_,p,V,q,C,L,I=B(a[4]),m=[];for(let c=0;c<I.length;c+=1)m[c]=le(ee(a,I,c));let O=B(a[5]),r=[];for(let c=0;c<O.length;c+=1)r[c]=ae(x(a,O,c));let T=B(a[3]),g=[];for(let c=0;c<T.length;c+=1)g[c]=ne($(a,T,c));return{c(){e=y("div"),t=y("div"),l=y("h1"),i=y("h1"),s=y("h3"),s.textContent=f,o=H(),u=y("ol");for(let c=0;c<m.length;c+=1)m[c].c();b=H(),_=y("div"),p=S(`Select your pointing system:
				`),V=y("ul");for(let c=0;c<r.length;c+=1)r[c].c();q=H();for(let c=0;c<g.length;c+=1)g[c].c();C=H(),L=y("div"),this.h()},l(c){e=k(c,"DIV",{class:!0});var v=E(e);t=k(v,"DIV",{});var n=E(t);l=k(n,"H1",{class:!0});var D=E(l);i=k(D,"H1",{});var G=E(i);s=k(G,"H3",{class:!0,"data-svelte-h":!0}),fe(s)!=="svelte-1vfpxjc"&&(s.textContent=f),o=z(G),u=k(G,"OL",{});var Q=E(u);for(let N=0;N<m.length;N+=1)m[N].l(Q);Q.forEach(h),G.forEach(h),D.forEach(h),n.forEach(h),b=z(v),_=k(v,"DIV",{});var F=E(_);p=w(F,`Select your pointing system:
				`),V=k(F,"UL",{});var R=E(V);for(let N=0;N<r.length;N+=1)r[N].l(R);R.forEach(h),q=z(F);for(let N=0;N<g.length;N+=1)g[N].l(F);F.forEach(h),C=z(v),L=k(v,"DIV",{}),E(L).forEach(h),v.forEach(h),this.h()},h(){P(s,"class","font-bold text-2xl mb-2"),P(l,"class","text-3xl font-bold p-3"),P(e,"class","grid grid-cols-3")},m(c,v){U(c,e,v),d(e,t),d(t,l),d(l,i),d(i,s),d(i,o),d(i,u);for(let n=0;n<m.length;n+=1)m[n]&&m[n].m(u,null);d(e,b),d(e,_),d(_,p),d(_,V);for(let n=0;n<r.length;n+=1)r[n]&&r[n].m(V,null);d(_,q);for(let n=0;n<g.length;n+=1)g[n]&&g[n].m(_,null);d(e,C),d(e,L)},p(c,v){if(v&17){I=B(c[4]);let n;for(n=0;n<I.length;n+=1){const D=ee(c,I,n);m[n]?m[n].p(D,v):(m[n]=le(D),m[n].c(),m[n].m(u,null))}for(;n<m.length;n+=1)m[n].d(1);m.length=I.length}if(v&34){O=B(c[5]);let n;for(n=0;n<O.length;n+=1){const D=x(c,O,n);r[n]?r[n].p(D,v):(r[n]=ae(D),r[n].c(),r[n].m(V,null))}for(;n<r.length;n+=1)r[n].d(1);r.length=O.length}if(v&74){T=B(c[3]);let n;for(n=0;n<T.length;n+=1){const D=$(c,T,n);g[n]?g[n].p(D,v):(g[n]=ne(D),g[n].c(),g[n].m(_,null))}for(;n<g.length;n+=1)g[n].d(1);g.length=T.length}},d(c){c&&h(e),J(m,c),J(r,c),J(g,c)}}}function de(a){let e,t=a[23].displayName+"",l,i,s=a[23].currentVote+"",f;return{c(){e=y("li"),l=S(t),i=S(": "),f=S(s),this.h()},l(o){e=k(o,"LI",{class:!0});var u=E(e);l=w(u,t),i=w(u,": "),f=w(u,s),u.forEach(h),this.h()},h(){P(e,"class","text-lg")},m(o,u){U(o,e,u),d(e,l),d(e,i),d(e,f)},p(o,u){u&16&&t!==(t=o[23].displayName+"")&&A(l,t),u&16&&s!==(s=o[23].currentVote+"")&&A(f,s)},d(o){o&&h(e)}}}function he(a){let e,t=a[23].displayName+"",l,i,s=a[23].currentVote+"",f;return{c(){e=y("li"),l=S(t),i=S(": "),f=S(s),this.h()},l(o){e=k(o,"LI",{class:!0});var u=E(e);l=w(u,t),i=w(u,": "),f=w(u,s),u.forEach(h),this.h()},h(){P(e,"class","text-lg font-bold text-lime-300")},m(o,u){U(o,e,u),d(e,l),d(e,i),d(e,f)},p(o,u){u&16&&t!==(t=o[23].displayName+"")&&A(l,t),u&16&&s!==(s=o[23].currentVote+"")&&A(f,s)},d(o){o&&h(e)}}}function le(a){let e;function t(s,f){return s[23].id===s[0].user.id?he:de}let l=t(a),i=l(a);return{c(){i.c(),e=Y()},l(s){i.l(s),e=Y()},m(s,f){i.m(s,f),U(s,e,f)},p(s,f){l===(l=t(s))&&i?i.p(s,f):(i.d(1),i=l(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){s&&h(e),i.d(s)}}}function ae(a){let e,t,l=a[20]+"",i,s,f,o,u;function b(){return a[8](a[20])}return{c(){e=y("li"),t=y("button"),i=S(l),f=H(),this.h()},l(_){e=k(_,"LI",{});var p=E(e);t=k(p,"BUTTON",{class:!0,"aria-current":!0,"aria-label":!0});var V=E(t);i=w(V,l),V.forEach(h),f=z(p),p.forEach(h),this.h()},h(){P(t,"class","border border-1 border-round bg-gray-700 hoder:bg-gray-600 m-1 p-2"),P(t,"aria-current",s=a[1]===a[20]),P(t,"aria-label",a[20])},m(_,p){U(_,e,p),d(e,t),d(t,i),d(e,f),o||(u=se(t,"click",b),o=!0)},p(_,p){a=_,p&2&&s!==(s=a[1]===a[20])&&P(t,"aria-current",s)},d(_){_&&h(e),o=!1,u()}}}function ne(a){let e,t=a[17]+"",l,i,s,f,o;function u(){return a[9](a[17])}return{c(){e=y("button"),l=S(t),this.h()},l(b){e=k(b,"BUTTON",{class:!0,"aria-current":!0,"aria-label":!0});var _=E(e);l=w(_,t),_.forEach(h),this.h()},h(){P(e,"class","border border-1 m-1 p-1"),P(e,"aria-current",i=a[1]===a[17]),P(e,"aria-label",s=a[17])},m(b,_){U(b,e,_),d(e,l),f||(o=se(e,"click",u),f=!0)},p(b,_){a=b,_&8&&t!==(t=a[17]+"")&&A(l,t),_&10&&i!==(i=a[1]===a[17])&&P(e,"aria-current",i),_&8&&s!==(s=a[17])&&P(e,"aria-label",s)},d(b){b&&h(e),f=!1,o()}}}function me(a){let e,t=a[2]&&a[0]&&te(a);return{c(){e=y("div"),t&&t.c(),this.h()},l(l){e=k(l,"DIV",{class:!0});var i=E(e);t&&t.l(i),i.forEach(h),this.h()},h(){P(e,"class","bg-zinc-900 text-yellow-100 p-8 min-h-screen flex flex-col justify-center items-center")},m(l,i){U(l,e,i),t&&t.m(e,null)},p(l,[i]){l[2]&&l[0]?t?t.p(l,i):(t=te(l),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:W,o:W,d(l){l&&h(e),t&&t.d()}}}function re(){return new Date().toISOString()}function ge(a,e,t){let l,i;X(a,j,r=>t(2,l=r)),X(a,K,r=>t(12,i=r));let{data:s}=e,{supabase:f,session:o}=s,u,b=[];const _=["Fibonacci"];let p=_[0];async function V(r){r.new.last_updated>l.last_updated&&(console.debug("syncPointingSession",r),j.set(r.new))}async function q(r){console.log(`Voted ${r}`,o.user.id),M(j,l.game_state.activePlayers[o.user.id].currentVote=r,l),M(j,l.game_state.activePlayers[o.user.id].displayName=i.display_name,l),M(j,l.game_state.last_updated=re(),l),await C()}async function C(){console.log("syncing game state",l),await f.from("PointingSession").update({game_state:l.game_state,last_updated:re()}).eq("id",l.id).select().single().then(r=>{r.data&&(j.set(r.data),console.log("updated game state",r)),r.error&&console.error("error updating game state",r.error)})}async function L(){await f.from("profiles").select("*").eq("id",o.user.id).limit(1).single().then(r=>{console.log("profile",r),r?.data?K.set(r.data):K.set({display_name:"default",temporary:!0})}),await f.from("PointingSession").select("*").eq("id",s.slug).single().then(r=>{console.log("Got pointing session",r,j),r.data&&(u=f.channel(`${s.slug}-${o.user.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"PointingSession",filter:`id=eq.${r.data.id}`},T=>V(T)).subscribe(),console.log("subscribing to reatltime updates",r.data.id,u),console.log("adding player to session",o.user.id),r.data.game_state.activePlayers[o.user.id]={id:o.user.id,displayName:i.display_name,currentVote:""},j.set(r.data),C())})}let I=[];oe(async()=>{s.slug||Z("/"),console.log("sessions",o),o||Z(`/auth?next=${location}`)});const m=r=>t(1,p=r),O=r=>q(r);return a.$$set=r=>{"data"in r&&t(7,s=r.data)},a.$$.update=()=>{a.$$.dirty&128&&t(0,{supabase:f,session:o}=s,o),a.$$.dirty&1&&o&&L(),a.$$.dirty&4&&l&&l?.game_state?.activePlayers&&t(4,I=Object.values(l.game_state.activePlayers)),a.$$.dirty&2&&p&&t(3,b={Fibonacci:{name:"Fibonacci",numbers:[1,2,3,5,8]}}[p].numbers)},[o,p,l,b,I,_,q,s,m,O]}class Pe extends ce{constructor(e){super(),ue(this,e,ge,me,ie,{data:7})}}export{Pe as component,ke as universal};
