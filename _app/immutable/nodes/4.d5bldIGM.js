import{s as ae,e as J,o as se,f as T}from"../chunks/scheduler.XGLZWGdw.js";import{S as ne,i as oe,g as p,h as b,j as y,f as g,k as C,a as O,d as $,t as B,b as te,s as U,x as re,c as z,y as h,p as le,z as K,e as Q,r as ie,u as ce,v as ue,w as fe,m as I,n as N,o as F}from"../chunks/index.li6Z87Pf.js";import{e as L,B as de,b as V,a as G}from"../chunks/button.0PSLqRbv.js";import{g as R}from"../chunks/navigation.7SQg30Qy.js";const _e=({params:n})=>({slug:n.slug}),Ve=Object.freeze(Object.defineProperty({__proto__:null,load:_e},Symbol.toStringTag,{value:"Module"}));function W(n,t,s){const e=n.slice();return e[16]=t[s],e}function X(n,t,s){const e=n.slice();return e[19]=t[s],e}function Y(n){let t,s,e,l,a,u="Player Votes",i,f,S,E,j,q,w,P=L(n[3]),m=[];for(let r=0;r<P.length;r+=1)m[r]=Z(X(n,P,r));let v=L(n[2]),d=[];for(let r=0;r<v.length;r+=1)d[r]=x(W(n,v,r));const c=r=>B(d[r],1,1,()=>{d[r]=null});return{c(){t=p("div"),s=p("div"),e=p("h1"),l=p("h1"),a=p("h3"),a.textContent=u,i=U(),f=p("ol");for(let r=0;r<m.length;r+=1)m[r].c();S=U(),E=p("div");for(let r=0;r<d.length;r+=1)d[r].c();j=U(),q=p("div"),this.h()},l(r){t=b(r,"DIV",{class:!0});var _=y(t);s=b(_,"DIV",{});var o=y(s);e=b(o,"H1",{class:!0});var k=y(e);l=b(k,"H1",{});var H=y(l);a=b(H,"H3",{class:!0,"data-svelte-h":!0}),re(a)!=="svelte-1vfpxjc"&&(a.textContent=u),i=z(H),f=b(H,"OL",{});var M=y(f);for(let D=0;D<m.length;D+=1)m[D].l(M);M.forEach(g),H.forEach(g),k.forEach(g),o.forEach(g),S=z(_),E=b(_,"DIV",{});var A=y(E);for(let D=0;D<d.length;D+=1)d[D].l(A);A.forEach(g),j=z(_),q=b(_,"DIV",{}),y(q).forEach(g),_.forEach(g),this.h()},h(){C(a,"class","font-bold text-2xl mb-2"),C(e,"class","text-3xl font-bold p-3"),C(t,"class","grid grid-cols-3")},m(r,_){O(r,t,_),h(t,s),h(s,e),h(e,l),h(l,a),h(l,i),h(l,f);for(let o=0;o<m.length;o+=1)m[o]&&m[o].m(f,null);h(t,S),h(t,E);for(let o=0;o<d.length;o+=1)d[o]&&d[o].m(E,null);h(t,j),h(t,q),w=!0},p(r,_){if(_&9){P=L(r[3]);let o;for(o=0;o<P.length;o+=1){const k=X(r,P,o);m[o]?m[o].p(k,_):(m[o]=Z(k),m[o].c(),m[o].m(f,null))}for(;o<m.length;o+=1)m[o].d(1);m.length=P.length}if(_&52){v=L(r[2]);let o;for(o=0;o<v.length;o+=1){const k=W(r,v,o);d[o]?(d[o].p(k,_),$(d[o],1)):(d[o]=x(k),d[o].c(),$(d[o],1),d[o].m(E,null))}for(le(),o=v.length;o<d.length;o+=1)c(o);te()}},i(r){if(!w){for(let _=0;_<v.length;_+=1)$(d[_]);w=!0}},o(r){d=d.filter(Boolean);for(let _=0;_<d.length;_+=1)B(d[_]);w=!1},d(r){r&&g(t),K(m,r),K(d,r)}}}function me(n){let t,s=n[19].displayName+"",e,l,a=n[19].currentVote+"",u;return{c(){t=p("li"),e=I(s),l=I(": "),u=I(a),this.h()},l(i){t=b(i,"LI",{class:!0});var f=y(t);e=N(f,s),l=N(f,": "),u=N(f,a),f.forEach(g),this.h()},h(){C(t,"class","text-lg")},m(i,f){O(i,t,f),h(t,e),h(t,l),h(t,u)},p(i,f){f&8&&s!==(s=i[19].displayName+"")&&F(e,s),f&8&&a!==(a=i[19].currentVote+"")&&F(u,a)},d(i){i&&g(t)}}}function he(n){let t,s=n[19].displayName+"",e,l,a=n[19].currentVote+"",u;return{c(){t=p("li"),e=I(s),l=I(": "),u=I(a),this.h()},l(i){t=b(i,"LI",{class:!0});var f=y(t);e=N(f,s),l=N(f,": "),u=N(f,a),f.forEach(g),this.h()},h(){C(t,"class","text-lg font-bold text-lime-300")},m(i,f){O(i,t,f),h(t,e),h(t,l),h(t,u)},p(i,f){f&8&&s!==(s=i[19].displayName+"")&&F(e,s),f&8&&a!==(a=i[19].currentVote+"")&&F(u,a)},d(i){i&&g(t)}}}function Z(n){let t;function s(a,u){return a[19].id===a[0].user.id?he:me}let e=s(n),l=e(n);return{c(){l.c(),t=Q()},l(a){l.l(a),t=Q()},m(a,u){l.m(a,u),O(a,t,u)},p(a,u){e===(e=s(a))&&l?l.p(a,u):(l.d(1),l=e(a),l&&(l.c(),l.m(t.parentNode,t)))},d(a){a&&g(t),l.d(a)}}}function ge(n){let t=n[16]+"",s;return{c(){s=I(t)},l(e){s=N(e,t)},m(e,l){O(e,s,l)},p(e,l){l&4&&t!==(t=e[16]+"")&&F(s,t)},d(e){e&&g(s)}}}function x(n){let t,s;function e(){return n[7](n[16])}return t=new de({props:{"aria-current":n[4]===n[16],"aria-label":n[16],$$slots:{default:[ge]},$$scope:{ctx:n}}}),t.$on("click",e),{c(){ie(t.$$.fragment)},l(l){ce(t.$$.fragment,l)},m(l,a){ue(t,l,a),s=!0},p(l,a){n=l;const u={};a&4&&(u["aria-current"]=n[4]===n[16]),a&4&&(u["aria-label"]=n[16]),a&4194308&&(u.$$scope={dirty:a,ctx:n}),t.$set(u)},i(l){s||($(t.$$.fragment,l),s=!0)},o(l){B(t.$$.fragment,l),s=!1},d(l){fe(t,l)}}}function pe(n){let t,s,e=n[1]&&n[0]&&Y(n);return{c(){t=p("div"),e&&e.c(),this.h()},l(l){t=b(l,"DIV",{class:!0});var a=y(t);e&&e.l(a),a.forEach(g),this.h()},h(){C(t,"class","text-yellow-100 p-8 h-full flex flex-col justify-center items-center")},m(l,a){O(l,t,a),e&&e.m(t,null),s=!0},p(l,[a]){l[1]&&l[0]?e?(e.p(l,a),a&3&&$(e,1)):(e=Y(l),e.c(),$(e,1),e.m(t,null)):e&&(le(),B(e,1,1,()=>{e=null}),te())},i(l){s||($(e),s=!0)},o(l){B(e),s=!1},d(l){l&&g(t),e&&e.d()}}}function ee(){return new Date().toISOString()}function be(n,t,s){let e,l;J(n,V,c=>s(1,e=c)),J(n,G,c=>s(10,l=c));let{data:a}=t,{supabase:u,session:i}=a,f,S=[],j=["Fibonacci"][0];async function q(c){c.new.last_updated>e.last_updated&&(console.debug("syncPointingSession",c),V.set(c.new))}async function w(c){console.log(`Voted ${c}`,i.user.id),T(V,e.game_state.activePlayers[i.user.id].currentVote=c,e),T(V,e.game_state.activePlayers[i.user.id].displayName=l.display_name,e),T(V,e.game_state.last_updated=ee(),e),await P()}async function P(){console.log("syncing game state",e),await u.from("PointingSession").update({game_state:e.game_state,last_updated:ee()}).eq("id",e.id).select().single().then(c=>{c.data&&(V.set(c.data),console.log("updated game state",c)),c.error&&console.error("error updating game state",c.error)})}async function m(){await u.from("profiles").select("*").eq("id",i.user.id).limit(1).single().then(c=>{console.log("profile",c),c?.data?G.set(c.data):G.set({display_name:"default",temporary:!0})}),await u.from("PointingSession").select("*").eq("id",a.slug).single().then(c=>{console.log("Got pointing session",c,V),c.data&&(f=u.channel(`${a.slug}-${i.user.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"PointingSession",filter:`id=eq.${c.data.id}`},r=>q(r)).subscribe(),console.log("subscribing to reatltime updates",c.data.id,f),console.log("adding player to session",i.user.id),c.data.game_state.activePlayers[i.user.id]={id:i.user.id,displayName:l.display_name,currentVote:""},V.set(c.data),P())})}let v=[];se(async()=>{a.slug||R("/"),console.log("sessions",i),i||R(`/auth?next=${location}`)});const d=c=>w(c);return n.$$set=c=>{"data"in c&&s(6,a=c.data)},n.$$.update=()=>{n.$$.dirty&64&&s(0,{supabase:u,session:i}=a,i),n.$$.dirty&1&&i&&m(),n.$$.dirty&2&&e&&e?.game_state?.activePlayers&&s(3,v=Object.values(e.game_state.activePlayers))},s(2,S={Fibonacci:{name:"Fibonacci",numbers:[1,2,3,5,8]}}[j].numbers),[i,e,S,v,j,w,a,d]}class Ee extends ne{constructor(t){super(),oe(this,t,be,pe,ae,{data:6})}}export{Ee as component,Ve as universal};
