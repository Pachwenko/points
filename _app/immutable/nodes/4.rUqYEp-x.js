import{s as be,e as ie,o as ve,f as R,n as ye}from"../chunks/scheduler.XGLZWGdw.js";import{S as $e,i as ke,g as $,h as k,j as P,f as m,k as J,a as S,d as V,t as O,b as Z,s as M,m as D,r as ee,x as Pe,c as A,n as I,u as te,y as h,v as le,p as x,z as W,w as ae,e as ce,o as Q}from"../chunks/index.li6Z87Pf.js";import{e as G,B as ne,b as F,a as X}from"../chunks/button.BW02HZU7.js";import{g as Y}from"../chunks/navigation.SN9JiIU2.js";const Ve=({params:a})=>({slug:a.slug}),Ue=Object.freeze(Object.defineProperty({__proto__:null,load:Ve},Symbol.toStringTag,{value:"Module"}));function ue(a,e,l){const t=a.slice();return t[19]=e[l],t}function fe(a,e,l){const t=a.slice();return t[22]=e[l],t}function _e(a,e,l){const t=a.slice();return t[25]=e[l],t}function de(a){let e,l,t,n,s,c="Player Votes",u,_,b,v,C,q,H,T,N,w,B,L=G(a[5]),p=[];for(let o=0;o<L.length;o+=1)p[o]=he(_e(a,L,o));let j=G(a[6]),r=[];for(let o=0;o<j.length;o+=1)r[o]=me(fe(a,j,o));const z=o=>O(r[o],1,1,()=>{r[o]=null});let U=G(a[3]),d=[];for(let o=0;o<U.length;o+=1)d[o]=ge(ue(a,U,o));const pe=o=>O(d[o],1,1,()=>{d[o]=null});return w=new ne({props:{$$slots:{default:[Ne]},$$scope:{ctx:a}}}),w.$on("click",a[12]),{c(){e=$("div"),l=$("div"),t=$("h1"),n=$("h1"),s=$("h3"),s.textContent=c,u=M(),_=$("ol");for(let o=0;o<p.length;o+=1)p[o].c();b=M(),v=$("div"),C=D(`Select your pointing system:
				`),q=$("ul");for(let o=0;o<r.length;o+=1)r[o].c();H=M();for(let o=0;o<d.length;o+=1)d[o].c();T=M(),N=$("div"),ee(w.$$.fragment),this.h()},l(o){e=k(o,"DIV",{class:!0});var f=P(e);l=k(f,"DIV",{});var g=P(l);t=k(g,"H1",{class:!0});var i=P(t);n=k(i,"H1",{});var y=P(n);s=k(y,"H3",{class:!0,"data-svelte-h":!0}),Pe(s)!=="svelte-1vfpxjc"&&(s.textContent=c),u=A(y),_=k(y,"OL",{});var re=P(_);for(let E=0;E<p.length;E+=1)p[E].l(re);re.forEach(m),y.forEach(m),i.forEach(m),g.forEach(m),b=A(f),v=k(f,"DIV",{});var K=P(v);C=I(K,`Select your pointing system:
				`),q=k(K,"UL",{});var se=P(q);for(let E=0;E<r.length;E+=1)r[E].l(se);se.forEach(m),H=A(K);for(let E=0;E<d.length;E+=1)d[E].l(K);K.forEach(m),T=A(f),N=k(f,"DIV",{});var oe=P(N);te(w.$$.fragment,oe),oe.forEach(m),f.forEach(m),this.h()},h(){J(s,"class","font-bold text-2xl mb-2"),J(t,"class","text-3xl font-bold p-3"),J(e,"class","grid grid-cols-3")},m(o,f){S(o,e,f),h(e,l),h(l,t),h(t,n),h(n,s),h(n,u),h(n,_);for(let g=0;g<p.length;g+=1)p[g]&&p[g].m(_,null);h(e,b),h(e,v),h(v,C),h(v,q);for(let g=0;g<r.length;g+=1)r[g]&&r[g].m(q,null);h(v,H);for(let g=0;g<d.length;g+=1)d[g]&&d[g].m(v,null);h(e,T),h(e,N),le(w,N,null),B=!0},p(o,f){if(f&33){L=G(o[5]);let i;for(i=0;i<L.length;i+=1){const y=_e(o,L,i);p[i]?p[i].p(y,f):(p[i]=he(y),p[i].c(),p[i].m(_,null))}for(;i<p.length;i+=1)p[i].d(1);p.length=L.length}if(f&66){j=G(o[6]);let i;for(i=0;i<j.length;i+=1){const y=fe(o,j,i);r[i]?(r[i].p(y,f),V(r[i],1)):(r[i]=me(y),r[i].c(),V(r[i],1),r[i].m(q,null))}for(x(),i=j.length;i<r.length;i+=1)z(i);Z()}if(f&152){U=G(o[3]);let i;for(i=0;i<U.length;i+=1){const y=ue(o,U,i);d[i]?(d[i].p(y,f),V(d[i],1)):(d[i]=ge(y),d[i].c(),V(d[i],1),d[i].m(v,null))}for(x(),i=U.length;i<d.length;i+=1)pe(i);Z()}const g={};f&268435456&&(g.$$scope={dirty:f,ctx:o}),w.$set(g)},i(o){if(!B){for(let f=0;f<j.length;f+=1)V(r[f]);for(let f=0;f<U.length;f+=1)V(d[f]);V(w.$$.fragment,o),B=!0}},o(o){r=r.filter(Boolean);for(let f=0;f<r.length;f+=1)O(r[f]);d=d.filter(Boolean);for(let f=0;f<d.length;f+=1)O(d[f]);O(w.$$.fragment,o),B=!1},d(o){o&&m(e),W(p,o),W(r,o),W(d,o),ae(w)}}}function we(a){let e,l=a[25].displayName+"",t,n,s=a[25].currentVote+"",c;return{c(){e=$("li"),t=D(l),n=D(": "),c=D(s),this.h()},l(u){e=k(u,"LI",{class:!0});var _=P(e);t=I(_,l),n=I(_,": "),c=I(_,s),_.forEach(m),this.h()},h(){J(e,"class","text-lg")},m(u,_){S(u,e,_),h(e,t),h(e,n),h(e,c)},p(u,_){_&32&&l!==(l=u[25].displayName+"")&&Q(t,l),_&32&&s!==(s=u[25].currentVote+"")&&Q(c,s)},d(u){u&&m(e)}}}function Ee(a){let e,l=a[25].displayName+"",t,n,s=a[25].currentVote+"",c,u;return{c(){e=$("li"),t=D(l),n=D(": "),c=D(s),u=M(),this.h()},l(_){e=k(_,"LI",{class:!0});var b=P(e);t=I(b,l),n=I(b,": "),c=I(b,s),u=A(b),b.forEach(m),this.h()},h(){J(e,"class","text-lg font-bold text-lime-300")},m(_,b){S(_,e,b),h(e,t),h(e,n),h(e,c),h(e,u)},p(_,b){b&32&&l!==(l=_[25].displayName+"")&&Q(t,l),b&32&&s!==(s=_[25].currentVote+"")&&Q(c,s)},d(_){_&&m(e)}}}function he(a){let e;function l(s,c){return s[25].id===s[0].user.id?Ee:we}let t=l(a),n=t(a);return{c(){n.c(),e=ce()},l(s){n.l(s),e=ce()},m(s,c){n.m(s,c),S(s,e,c)},p(s,c){t===(t=l(s))&&n?n.p(s,c):(n.d(1),n=t(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&m(e),n.d(s)}}}function De(a){let e=a[22]+"",l;return{c(){l=D(e)},l(t){l=I(t,e)},m(t,n){S(t,l,n)},p:ye,d(t){t&&m(l)}}}function me(a){let e,l,t,n;function s(){return a[10](a[22])}return l=new ne({props:{"aria-current":a[1]===a[22],"aria-label":a[22],$$slots:{default:[De]},$$scope:{ctx:a}}}),l.$on("click",s),{c(){e=$("li"),ee(l.$$.fragment),t=M()},l(c){e=k(c,"LI",{});var u=P(e);te(l.$$.fragment,u),t=A(u),u.forEach(m)},m(c,u){S(c,e,u),le(l,e,null),h(e,t),n=!0},p(c,u){a=c;const _={};u&2&&(_["aria-current"]=a[1]===a[22]),u&268435456&&(_.$$scope={dirty:u,ctx:a}),l.$set(_)},i(c){n||(V(l.$$.fragment,c),n=!0)},o(c){O(l.$$.fragment,c),n=!1},d(c){c&&m(e),ae(l)}}}function Ie(a){let e=a[19]+"",l;return{c(){l=D(e)},l(t){l=I(t,e)},m(t,n){S(t,l,n)},p(t,n){n&8&&e!==(e=t[19]+"")&&Q(l,e)},d(t){t&&m(l)}}}function ge(a){let e,l;function t(){return a[11](a[19])}return e=new ne({props:{"aria-current":a[4]===a[19],"aria-label":a[19],selected:a[4]===a[19],$$slots:{default:[Ie]},$$scope:{ctx:a}}}),e.$on("click",t),{c(){ee(e.$$.fragment)},l(n){te(e.$$.fragment,n)},m(n,s){le(e,n,s),l=!0},p(n,s){a=n;const c={};s&24&&(c["aria-current"]=a[4]===a[19]),s&8&&(c["aria-label"]=a[19]),s&24&&(c.selected=a[4]===a[19]),s&268435464&&(c.$$scope={dirty:s,ctx:a}),e.$set(c)},i(n){l||(V(e.$$.fragment,n),l=!0)},o(n){O(e.$$.fragment,n),l=!1},d(n){ae(e,n)}}}function Ne(a){let e;return{c(){e=D("Clear Votes")},l(l){e=I(l,"Clear Votes")},m(l,t){S(l,e,t)},d(l){l&&m(e)}}}function je(a){let e,l,t=a[2]&&a[0]&&de(a);return{c(){e=$("div"),t&&t.c(),this.h()},l(n){e=k(n,"DIV",{class:!0});var s=P(e);t&&t.l(s),s.forEach(m),this.h()},h(){J(e,"class","text-yellow-100 p-8 h-full flex flex-col justify-center items-center")},m(n,s){S(n,e,s),t&&t.m(e,null),l=!0},p(n,[s]){n[2]&&n[0]?t?(t.p(n,s),s&5&&V(t,1)):(t=de(n),t.c(),V(t,1),t.m(e,null)):t&&(x(),O(t,1,1,()=>{t=null}),Z())},i(n){l||(V(t),l=!0)},o(n){O(t),l=!1},d(n){n&&m(e),t&&t.d()}}}function Oe(){return new Date().toISOString()}function Se(a,e,l){let t,n;ie(a,F,r=>l(2,t=r)),ie(a,X,r=>l(15,n=r));let{data:s}=e,{supabase:c,session:u}=s,_=[];const b=["Fibonacci"];let v=b[0],C;async function q(r){r.new.last_updated>t.last_updated&&(console.debug("syncPointingSession",r),F.set(r.new))}async function H(r){l(4,C=r),R(F,t.game_state.activePlayers[u.user.id].currentVote=C,t),R(F,t.game_state.activePlayers[u.user.id].displayName=n.display_name,t),R(F,t.game_state.last_updated=Oe(),t),await N()}async function T(){l(4,C=""),Object.entries(t.game_state.activePlayers).forEach(([r,z])=>(z.currentVote="",z)),await N()}async function N(){await c.from("PointingSession").update({game_state:t.game_state,last_updated:t.last_updated}).eq("id",t.id).select().single().then(r=>{r.data&&(F.set(r.data),console.log("synced game state",r)),r.error&&console.error("error updating game state",r.error)})}async function w(){await c.from("profiles").select("*").eq("id",u.user.id).limit(1).single().then(r=>{r?.data?X.set(r.data):X.set({display_name:"default",temporary:!0})}),await c.from("PointingSession").select("*").eq("id",s.slug).single().then(r=>{console.log("Got the pointing session",r),r.data?(c.channel(`${s.slug}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"PointingSession",filter:`id=eq.${r.data.id}`},z=>q(z)).subscribe(),Object.hasOwn(r.data.game_state.activePlayers,u.user.id)?(console.log("syncing display name"),r.data.game_state.activePlayers[u.user.id]={...r.data.game_state.activePlayers[u.user.id],displayName:n.display_name}):r.data.game_state.activePlayers[u.user.id]={currentVote:"",id:u.user.id,displayName:n.display_name},F.set(r.data),N()):Y("/")})}let B=[];ve(async()=>{s.slug||Y("/"),console.log("sessions",u),u||Y(`/auth?next=${location}`)});const L=r=>l(1,v=r),p=r=>H(r),j=()=>T();return a.$$set=r=>{"data"in r&&l(9,s=r.data)},a.$$.update=()=>{a.$$.dirty&512&&l(0,{supabase:c,session:u}=s,u),a.$$.dirty&1&&u&&w(),a.$$.dirty&4&&t&&t?.game_state?.activePlayers&&l(5,B=Object.values(t.game_state.activePlayers)),a.$$.dirty&2&&v&&l(3,_={Fibonacci:{name:"Fibonacci",numbers:[1,2,3,5,8]}}[v].numbers)},[u,v,t,_,C,B,b,H,T,s,L,p,j]}class Fe extends $e{constructor(e){super(),ke(this,e,Se,je,be,{data:9})}}export{Fe as component,Ue as universal};
