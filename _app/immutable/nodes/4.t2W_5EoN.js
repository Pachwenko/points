import{s as ie,n as W,e as X,o as oe,f as M}from"../chunks/scheduler.Z_PGJaWH.js";import{S as ce,i as ue,g as y,h as k,j as E,f as h,k as P,a as U,s as z,m as I,x as fe,c as A,n as S,y as d,A as J,e as Y,z as se,o as B}from"../chunks/index.i8b6seFL.js";import{e as F,b as j,a as K}from"../chunks/store.VR57sI3V.js";import{g as Z}from"../chunks/navigation.-9TJl58b.js";const _e=({params:a})=>({slug:a.slug}),ke=Object.freeze(Object.defineProperty({__proto__:null,load:_e},Symbol.toStringTag,{value:"Module"}));function $(a,e,t){const l=a.slice();return l[17]=e[t],l}function x(a,e,t){const l=a.slice();return l[20]=e[t],l}function ee(a,e,t){const l=a.slice();return l[23]=e[t],l}function te(a){let e,t,l,i,s,f="Player Votes",o,u,b,_,p,V,q,C,L,w=F(a[4]),m=[];for(let c=0;c<w.length;c+=1)m[c]=le(ee(a,w,c));let O=F(a[5]),n=[];for(let c=0;c<O.length;c+=1)n[c]=ae(x(a,O,c));let T=F(a[3]),g=[];for(let c=0;c<T.length;c+=1)g[c]=re($(a,T,c));return{c(){e=y("div"),t=y("div"),l=y("h1"),i=y("h1"),s=y("h3"),s.textContent=f,o=z(),u=y("ol");for(let c=0;c<m.length;c+=1)m[c].c();b=z(),_=y("div"),p=I(`Select your pointing system:
				`),V=y("ul");for(let c=0;c<n.length;c+=1)n[c].c();q=z();for(let c=0;c<g.length;c+=1)g[c].c();C=z(),L=y("div"),this.h()},l(c){e=k(c,"DIV",{class:!0});var v=E(e);t=k(v,"DIV",{});var r=E(t);l=k(r,"H1",{class:!0});var D=E(l);i=k(D,"H1",{});var G=E(i);s=k(G,"H3",{class:!0,"data-svelte-h":!0}),fe(s)!=="svelte-1vfpxjc"&&(s.textContent=f),o=A(G),u=k(G,"OL",{});var Q=E(u);for(let N=0;N<m.length;N+=1)m[N].l(Q);Q.forEach(h),G.forEach(h),D.forEach(h),r.forEach(h),b=A(v),_=k(v,"DIV",{});var H=E(_);p=S(H,`Select your pointing system:
				`),V=k(H,"UL",{});var R=E(V);for(let N=0;N<n.length;N+=1)n[N].l(R);R.forEach(h),q=A(H);for(let N=0;N<g.length;N+=1)g[N].l(H);H.forEach(h),C=A(v),L=k(v,"DIV",{}),E(L).forEach(h),v.forEach(h),this.h()},h(){P(s,"class","font-bold text-2xl mb-2"),P(l,"class","text-3xl font-bold p-3"),P(e,"class","grid grid-cols-3")},m(c,v){U(c,e,v),d(e,t),d(t,l),d(l,i),d(i,s),d(i,o),d(i,u);for(let r=0;r<m.length;r+=1)m[r]&&m[r].m(u,null);d(e,b),d(e,_),d(_,p),d(_,V);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(V,null);d(_,q);for(let r=0;r<g.length;r+=1)g[r]&&g[r].m(_,null);d(e,C),d(e,L)},p(c,v){if(v&17){w=F(c[4]);let r;for(r=0;r<w.length;r+=1){const D=ee(c,w,r);m[r]?m[r].p(D,v):(m[r]=le(D),m[r].c(),m[r].m(u,null))}for(;r<m.length;r+=1)m[r].d(1);m.length=w.length}if(v&34){O=F(c[5]);let r;for(r=0;r<O.length;r+=1){const D=x(c,O,r);n[r]?n[r].p(D,v):(n[r]=ae(D),n[r].c(),n[r].m(V,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=O.length}if(v&74){T=F(c[3]);let r;for(r=0;r<T.length;r+=1){const D=$(c,T,r);g[r]?g[r].p(D,v):(g[r]=re(D),g[r].c(),g[r].m(_,null))}for(;r<g.length;r+=1)g[r].d(1);g.length=T.length}},d(c){c&&h(e),J(m,c),J(n,c),J(g,c)}}}function de(a){let e,t=a[23].displayName+"",l,i,s=a[23].currentVote+"",f;return{c(){e=y("li"),l=I(t),i=I(": "),f=I(s),this.h()},l(o){e=k(o,"LI",{class:!0});var u=E(e);l=S(u,t),i=S(u,": "),f=S(u,s),u.forEach(h),this.h()},h(){P(e,"class","text-lg")},m(o,u){U(o,e,u),d(e,l),d(e,i),d(e,f)},p(o,u){u&16&&t!==(t=o[23].displayName+"")&&B(l,t),u&16&&s!==(s=o[23].currentVote+"")&&B(f,s)},d(o){o&&h(e)}}}function he(a){let e,t=a[23].displayName+"",l,i,s=a[23].currentVote+"",f;return{c(){e=y("li"),l=I(t),i=I(": "),f=I(s),this.h()},l(o){e=k(o,"LI",{class:!0});var u=E(e);l=S(u,t),i=S(u,": "),f=S(u,s),u.forEach(h),this.h()},h(){P(e,"class","text-lg font-bold text-yellow-200")},m(o,u){U(o,e,u),d(e,l),d(e,i),d(e,f)},p(o,u){u&16&&t!==(t=o[23].displayName+"")&&B(l,t),u&16&&s!==(s=o[23].currentVote+"")&&B(f,s)},d(o){o&&h(e)}}}function le(a){let e;function t(s,f){return s[23].id===s[0].user.id?he:de}let l=t(a),i=l(a);return{c(){i.c(),e=Y()},l(s){i.l(s),e=Y()},m(s,f){i.m(s,f),U(s,e,f)},p(s,f){l===(l=t(s))&&i?i.p(s,f):(i.d(1),i=l(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){s&&h(e),i.d(s)}}}function ae(a){let e,t,l=a[20]+"",i,s,f,o,u;function b(){return a[8](a[20])}return{c(){e=y("li"),t=y("button"),i=I(l),f=z(),this.h()},l(_){e=k(_,"LI",{});var p=E(e);t=k(p,"BUTTON",{class:!0,"aria-current":!0,"aria-label":!0});var V=E(t);i=S(V,l),V.forEach(h),f=A(p),p.forEach(h),this.h()},h(){P(t,"class","border border-1 border-round bg-gray-700 hoder:bg-gray-600 m-1 p-2"),P(t,"aria-current",s=a[1]===a[20]),P(t,"aria-label",a[20])},m(_,p){U(_,e,p),d(e,t),d(t,i),d(e,f),o||(u=se(t,"click",b),o=!0)},p(_,p){a=_,p&2&&s!==(s=a[1]===a[20])&&P(t,"aria-current",s)},d(_){_&&h(e),o=!1,u()}}}function re(a){let e,t=a[17]+"",l,i,s,f,o;function u(){return a[9](a[17])}return{c(){e=y("button"),l=I(t),this.h()},l(b){e=k(b,"BUTTON",{class:!0,"aria-current":!0,"aria-label":!0});var _=E(e);l=S(_,t),_.forEach(h),this.h()},h(){P(e,"class","border border-1 m-1 p-1"),P(e,"aria-current",i=a[1]===a[17]),P(e,"aria-label",s=a[17])},m(b,_){U(b,e,_),d(e,l),f||(o=se(e,"click",u),f=!0)},p(b,_){a=b,_&8&&t!==(t=a[17]+"")&&B(l,t),_&10&&i!==(i=a[1]===a[17])&&P(e,"aria-current",i),_&8&&s!==(s=a[17])&&P(e,"aria-label",s)},d(b){b&&h(e),f=!1,o()}}}function me(a){let e,t=a[2]&&a[0]&&te(a);return{c(){e=y("div"),t&&t.c(),this.h()},l(l){e=k(l,"DIV",{class:!0});var i=E(e);t&&t.l(i),i.forEach(h),this.h()},h(){P(e,"class","bg-gray-900 text-white p-8 min-h-screen flex flex-col justify-center items-center")},m(l,i){U(l,e,i),t&&t.m(e,null)},p(l,[i]){l[2]&&l[0]?t?t.p(l,i):(t=te(l),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:W,o:W,d(l){l&&h(e),t&&t.d()}}}function ne(){return new Date().toISOString()}function ge(a,e,t){let l,i;X(a,j,n=>t(2,l=n)),X(a,K,n=>t(12,i=n));let{data:s}=e,{supabase:f,session:o}=s,u,b=[];const _=["Fibonacci"];let p=_[0];async function V(n){n.new.last_updated>l.last_updated&&(console.debug("syncPointingSession",n),j.set(n.new))}async function q(n){console.log(`Voted ${n}`,o.user.id),M(j,l.game_state.activePlayers[o.user.id].currentVote=n,l),M(j,l.game_state.activePlayers[o.user.id].displayName=i.display_name,l),M(j,l.game_state.last_updated=ne(),l),await C()}async function C(){console.log("syncing game state",l),await f.from("PointingSession").update({game_state:l.game_state,last_updated:ne()}).eq("id",l.id).select().single().then(n=>{n.data&&(j.set(n.data),console.log("updated game state",n)),n.error&&console.error("error updating game state",n.error)})}async function L(){await f.from("profiles").select("*").eq("id",o.user.id).limit(1).single().then(n=>{console.log("profile",n),n?.data?K.set(n.data):K.set({display_name:"default",temporary:!0})}),await f.from("PointingSession").select("*").eq("id",s.slug).single().then(n=>{console.log("Got pointing session",n,j),n.data&&(u=f.channel(`${s.slug}-${o.user.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"PointingSession",filter:`id=eq.${n.data.id}`},T=>V(T)).subscribe(),console.log("subscribing to reatltime updates",n.data.id,u),console.log("adding player to session",o.user.id),n.data.game_state.activePlayers[o.user.id]={id:o.user.id,displayName:i.display_name,currentVote:""},j.set(n.data),C())})}let w=[];oe(async()=>{s.slug||Z("/"),console.log("sessions",o),o||Z(`/auth?next=${location}`)});const m=n=>t(1,p=n),O=n=>q(n);return a.$$set=n=>{"data"in n&&t(7,s=n.data)},a.$$.update=()=>{a.$$.dirty&128&&t(0,{supabase:f,session:o}=s,o),a.$$.dirty&1&&o&&L(),a.$$.dirty&4&&l&&l?.game_state?.activePlayers&&t(4,w=Object.values(l.game_state.activePlayers)),a.$$.dirty&2&&p&&t(3,b={Fibonacci:{name:"Fibonacci",numbers:[1,2,3,5,8]}}[p].numbers)},[o,p,l,b,w,_,q,s,m,O]}class Pe extends ce{constructor(e){super(),ue(this,e,ge,me,ie,{data:7})}}export{Pe as component,ke as universal};
