import{s as W,n as V,e as q,o as F}from"../chunks/scheduler.Z_PGJaWH.js";import{S as G,i as J,e as A,a as E,f as p,g,s as I,h as v,j as C,x as N,c as w,k as P,y as u,z as K,m as S,n as x,A as Q,o as j}from"../chunks/index.i8b6seFL.js";import{e as L,c as T,a as D}from"../chunks/store.8eY6meUO.js";import{g as z}from"../chunks/navigation.BDY4RwZ-.js";function B(r,t,e){const s=r.slice();return s[6]=t[e],s}function H(r){let t,e,s,o="Welcome to Spring Pointing!",l,n,c,a="Start new Pointing Session",i,_,h;function k(d,b){return d[1]?X:R}let U=k(r),m=U(r),f=r[2]&&M(r);return{c(){t=g("div"),e=g("div"),s=g("h1"),s.textContent=o,l=I(),m.c(),n=I(),c=g("button"),c.textContent=a,i=I(),f&&f.c(),this.h()},l(d){t=v(d,"DIV",{class:!0});var b=C(t);e=v(b,"DIV",{class:!0});var y=C(e);s=v(y,"H1",{class:!0,"data-svelte-h":!0}),N(s)!=="svelte-gcb7u4"&&(s.textContent=o),l=w(y),m.l(y),n=w(y),c=v(y,"BUTTON",{class:!0,"data-svelte-h":!0}),N(c)!=="svelte-k8on3b"&&(c.textContent=a),i=w(y),f&&f.l(y),y.forEach(p),b.forEach(p),this.h()},h(){P(s,"class","text-3xl font-bold"),P(c,"class","bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"),P(e,"class","container mx-auto border border-1 p-2"),P(t,"class","bg-gray-900 text-white p-8 min-h-full flex flex-col flex-grow justify-center items-center")},m(d,b){E(d,t,b),u(t,e),u(e,s),u(e,l),m.m(e,null),u(e,n),u(e,c),u(e,i),f&&f.m(e,null),_||(h=K(c,"click",r[3]),_=!0)},p(d,b){U===(U=k(d))&&m?m.p(d,b):(m.d(1),m=U(d),m&&(m.c(),m.m(e,n))),d[2]?f?f.p(d,b):(f=M(d),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(d){d&&p(t),m.d(),f&&f.d(),_=!1,h()}}}function R(r){let t,e="Current display name: loading...";return{c(){t=g("p"),t.textContent=e},l(s){t=v(s,"P",{"data-svelte-h":!0}),N(t)!=="svelte-u9upty"&&(t.textContent=e)},m(s,o){E(s,t,o)},p:V,d(s){s&&p(t)}}}function X(r){let t,e,s=r[1].display_name+"",o;return{c(){t=g("p"),e=S("Current display name: "),o=S(s)},l(l){t=v(l,"P",{});var n=C(t);e=x(n,"Current display name: "),o=x(n,s),n.forEach(p)},m(l,n){E(l,t,n),u(t,e),u(t,o)},p(l,n){n&2&&s!==(s=l[1].display_name+"")&&j(o,s)},d(l){l&&p(t)}}}function M(r){let t,e,s,o=L(r[2]),l=[];for(let n=0;n<o.length;n+=1)l[n]=O(B(r,o,n));return{c(){t=g("div"),e=S(`Previous Sessions:
                `),s=g("ul");for(let n=0;n<l.length;n+=1)l[n].c()},l(n){t=v(n,"DIV",{});var c=C(t);e=x(c,`Previous Sessions:
                `),s=v(c,"UL",{});var a=C(s);for(let i=0;i<l.length;i+=1)l[i].l(a);a.forEach(p),c.forEach(p)},m(n,c){E(n,t,c),u(t,e),u(t,s);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(s,null)},p(n,c){if(c&4){o=L(n[2]);let a;for(a=0;a<o.length;a+=1){const i=B(n,o,a);l[a]?l[a].p(i,c):(l[a]=O(i),l[a].c(),l[a].m(s,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=o.length}},d(n){n&&p(t),Q(l,n)}}}function O(r){let t,e,s=r[6].id+"",o,l,n=r[6].last_updated+"",c,a,i;return{c(){t=g("li"),e=g("a"),o=S(s),l=S(" - "),c=S(n),i=I(),this.h()},l(_){t=v(_,"LI",{});var h=C(t);e=v(h,"A",{href:!0});var k=C(e);o=x(k,s),l=x(k," - "),c=x(k,n),k.forEach(p),i=w(h),h.forEach(p),this.h()},h(){P(e,"href",a="/points/"+r[6].id+"/")},m(_,h){E(_,t,h),u(t,e),u(e,o),u(e,l),u(e,c),u(t,i)},p(_,h){h&4&&s!==(s=_[6].id+"")&&j(o,s),h&4&&n!==(n=_[6].last_updated+"")&&j(c,n),h&4&&a!==(a="/points/"+_[6].id+"/")&&P(e,"href",a)},d(_){_&&p(t)}}}function Y(r){let t,e=r[0].session&&H(r);return{c(){e&&e.c(),t=A()},l(s){e&&e.l(s),t=A()},m(s,o){e&&e.m(s,o),E(s,t,o)},p(s,[o]){s[0].session?e?e.p(s,o):(e=H(s),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:V,o:V,d(s){s&&p(t),e&&e.d(s)}}}function Z(r,t,e){let s,o;q(r,D,i=>e(1,s=i)),q(r,T,i=>e(2,o=i));let{data:l}=t,{supabase:n}=l;async function c(){l.session.user.id,n.from("PointingSession").insert({last_updated:new date().toisostring(),game_state:{activePlayers:{userId:{id:l.session.user.id,displayName:s.display_name,currentVote:null}}},users:[l.session.user.id]}).select().single().then(i=>{console.log("started new session",i),i.data&&z(`/points/${i.data.id}`)})}async function a(){n.from("PointingSession").select().then(i=>{T.set(i.data)}),n.from("profiles").select("*").eq("id",l.session?.user.id).limit(1).single().then(i=>{console.log("profile",i),i?.data?D.set(i.data):D.set({display_name:"default",temporary:!0})})}return F(async()=>{l.session||z("/auth")}),r.$$set=i=>{"data"in i&&e(0,l=i.data)},r.$$.update=()=>{r.$$.dirty&1&&({supabase:n}=l),r.$$.dirty&1&&l.session&&a()},[l,s,o,c]}class le extends G{constructor(t){super(),J(this,t,Z,Y,W,{data:0})}}export{le as component};
