import{s as W,n as V,e as j,o as F}from"../chunks/scheduler.Z_PGJaWH.js";import{S as G,i as J,e as A,a as E,f as p,g as v,s as D,h as g,j as C,x as q,c as I,k as P,y as d,z as K,m as S,n as x,A as Q,o as N}from"../chunks/index.i8b6seFL.js";import{e as L,c as O,a as w}from"../chunks/store._jQ-yhp_.js";import{g as T}from"../chunks/navigation.s0Ho3WJw.js";function z(r,t,e){const s=r.slice();return s[6]=t[e],s}function B(r){let t,e,s,o="Welcome to Spring Pointing!",n,l,c,i="Start new Pointing Session",a,f,h;function k(_,b){return _[1]?X:R}let U=k(r),m=U(r),u=r[2]&&H(r);return{c(){t=v("div"),e=v("div"),s=v("h1"),s.textContent=o,n=D(),m.c(),l=D(),c=v("button"),c.textContent=i,a=D(),u&&u.c(),this.h()},l(_){t=g(_,"DIV",{class:!0});var b=C(t);e=g(b,"DIV",{class:!0});var y=C(e);s=g(y,"H1",{class:!0,"data-svelte-h":!0}),q(s)!=="svelte-gcb7u4"&&(s.textContent=o),n=I(y),m.l(y),l=I(y),c=g(y,"BUTTON",{class:!0,"data-svelte-h":!0}),q(c)!=="svelte-1oq9o6h"&&(c.textContent=i),a=I(y),u&&u.l(y),y.forEach(p),b.forEach(p),this.h()},h(){P(s,"class","text-3xl font-bold"),P(c,"class","bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"),P(e,"class","container mx-auto border border-1 p-2"),P(t,"class","bg-gray-900 text-white p-8 min-h-full flex flex-col flex-grow justify-center items-center")},m(_,b){E(_,t,b),d(t,e),d(e,s),d(e,n),m.m(e,null),d(e,l),d(e,c),d(e,a),u&&u.m(e,null),f||(h=K(c,"click",r[3]),f=!0)},p(_,b){U===(U=k(_))&&m?m.p(_,b):(m.d(1),m=U(_),m&&(m.c(),m.m(e,l))),_[2]?u?u.p(_,b):(u=H(_),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},d(_){_&&p(t),m.d(),u&&u.d(),f=!1,h()}}}function R(r){let t,e="Current display name: loading...";return{c(){t=v("p"),t.textContent=e},l(s){t=g(s,"P",{"data-svelte-h":!0}),q(t)!=="svelte-u9upty"&&(t.textContent=e)},m(s,o){E(s,t,o)},p:V,d(s){s&&p(t)}}}function X(r){let t,e,s=r[1].display_name+"",o;return{c(){t=v("p"),e=S("Current display name: "),o=S(s)},l(n){t=g(n,"P",{});var l=C(t);e=x(l,"Current display name: "),o=x(l,s),l.forEach(p)},m(n,l){E(n,t,l),d(t,e),d(t,o)},p(n,l){l&2&&s!==(s=n[1].display_name+"")&&N(o,s)},d(n){n&&p(t)}}}function H(r){let t,e,s,o=L(r[2]),n=[];for(let l=0;l<o.length;l+=1)n[l]=M(z(r,o,l));return{c(){t=v("div"),e=S(`Previous Sessions:
					`),s=v("ul");for(let l=0;l<n.length;l+=1)n[l].c()},l(l){t=g(l,"DIV",{});var c=C(t);e=x(c,`Previous Sessions:
					`),s=g(c,"UL",{});var i=C(s);for(let a=0;a<n.length;a+=1)n[a].l(i);i.forEach(p),c.forEach(p)},m(l,c){E(l,t,c),d(t,e),d(t,s);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(s,null)},p(l,c){if(c&4){o=L(l[2]);let i;for(i=0;i<o.length;i+=1){const a=z(l,o,i);n[i]?n[i].p(a,c):(n[i]=M(a),n[i].c(),n[i].m(s,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=o.length}},d(l){l&&p(t),Q(n,l)}}}function M(r){let t,e,s=r[6].id+"",o,n,l=r[6].last_updated+"",c,i,a;return{c(){t=v("li"),e=v("a"),o=S(s),n=S(" - "),c=S(l),a=D(),this.h()},l(f){t=g(f,"LI",{});var h=C(t);e=g(h,"A",{href:!0});var k=C(e);o=x(k,s),n=x(k," - "),c=x(k,l),k.forEach(p),a=I(h),h.forEach(p),this.h()},h(){P(e,"href",i="/points/"+r[6].id+"/")},m(f,h){E(f,t,h),d(t,e),d(e,o),d(e,n),d(e,c),d(t,a)},p(f,h){h&4&&s!==(s=f[6].id+"")&&N(o,s),h&4&&l!==(l=f[6].last_updated+"")&&N(c,l),h&4&&i!==(i="/points/"+f[6].id+"/")&&P(e,"href",i)},d(f){f&&p(t)}}}function Y(r){let t,e=r[0].session&&B(r);return{c(){e&&e.c(),t=A()},l(s){e&&e.l(s),t=A()},m(s,o){e&&e.m(s,o),E(s,t,o)},p(s,[o]){s[0].session?e?e.p(s,o):(e=B(s),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:V,o:V,d(s){s&&p(t),e&&e.d(s)}}}function Z(r,t,e){let s,o;j(r,w,a=>e(1,s=a)),j(r,O,a=>e(2,o=a));let{data:n}=t,{supabase:l}=n;async function c(){const a={version:1,activePlayers:{}};a[n.session.user.is]={id:n.session.user.id,displayName:s.display_name,currentVote:""},l.from("PointingSession").insert({last_updated:new Date().toISOString(),game_state:a,users:[n.session.user.id]}).select().single().then(f=>{console.log("started new session",f),f.data&&T(`/points/${f.data.id}`)})}async function i(){l.from("PointingSession").select().contains("users",[n.session?.user.id]).then(a=>{O.set(a.data)}),l.from("profiles").select("*").eq("id",n.session?.user.id).limit(1).single().then(a=>{console.log("profile",a),a?.data?w.set(a.data):w.set({display_name:"default",temporary:!0})})}return F(async()=>{n.session||T("/auth")}),r.$$set=a=>{"data"in a&&e(0,n=a.data)},r.$$.update=()=>{r.$$.dirty&1&&({supabase:l}=n),r.$$.dirty&1&&n.session&&i()},[n,s,o,c]}class ne extends G{constructor(t){super(),J(this,t,Z,Y,W,{data:0})}}export{ne as component};
