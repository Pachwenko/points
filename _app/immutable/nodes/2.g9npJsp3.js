import{s as z,e as L,i as S,d as p,A as q,o as O,f as g,a as D,g as b,h as P,u as w,c as I,j as k,v as _,l as E,m as C,B as W,n as U,z as F}from"../chunks/scheduler.wCkDe2Ta.js";import{S as G,i as J,a as x,t as V,c as K,b as Q,d as R,m as X,e as Y,g as Z}from"../chunks/index.LId1ysqj.js";import{B as ee,e as H,c as j,a as $}from"../chunks/button.kyY1xn4m.js";import{g as B}from"../chunks/navigation.sly37ktX.js";function M(f,e,s){const t=f.slice();return t[7]=e[s],t}function A(f){let e,s,t,i="Welcome to Pointing Poker",o,d,u,h,m;function l(a,y){return a[1]?se:te}let r=l(f),c=r(f);u=new ee({props:{$$slots:{default:[ne]},$$scope:{ctx:f}}}),u.$on("click",f[3]);let n=f[2]&&N(f);return{c(){e=g("div"),s=g("div"),t=g("h1"),t.textContent=i,o=D(),c.c(),d=D(),Q(u.$$.fragment),h=D(),n&&n.c(),this.h()},l(a){e=b(a,"DIV",{class:!0});var y=P(e);s=b(y,"DIV",{class:!0});var v=P(s);t=b(v,"H1",{class:!0,"data-svelte-h":!0}),w(t)!=="svelte-1c2fdh4"&&(t.textContent=i),o=I(v),c.l(v),d=I(v),R(u.$$.fragment,v),h=I(v),n&&n.l(v),v.forEach(p),y.forEach(p),this.h()},h(){k(t,"class","text-center text-3xl font-bold"),k(s,"class","container mx-auto p-2 text-center"),k(e,"class","p-8 min-h-full flex flex-col flex-grow justify-center items-center")},m(a,y){S(a,e,y),_(e,s),_(s,t),_(s,o),c.m(s,null),_(s,d),X(u,s,null),_(s,h),n&&n.m(s,null),m=!0},p(a,y){r===(r=l(a))&&c?c.p(a,y):(c.d(1),c=r(a),c&&(c.c(),c.m(s,d)));const v={};y&1024&&(v.$$scope={dirty:y,ctx:a}),u.$set(v),a[2]?n?n.p(a,y):(n=N(a),n.c(),n.m(s,null)):n&&(n.d(1),n=null)},i(a){m||(x(u.$$.fragment,a),m=!0)},o(a){V(u.$$.fragment,a),m=!1},d(a){a&&p(e),c.d(),Y(u),n&&n.d()}}}function te(f){let e,s="Display name: loading...";return{c(){e=g("div"),e.textContent=s},l(t){e=b(t,"DIV",{"data-svelte-h":!0}),w(e)!=="svelte-1ar43gj"&&(e.textContent=s)},m(t,i){S(t,e,i)},p:F,d(t){t&&p(e)}}}function se(f){let e,s,t,i=f[1].display_name+"",o;return{c(){e=g("div"),s=E("Display name: "),t=g("p"),o=E(i),this.h()},l(d){e=b(d,"DIV",{});var u=P(e);s=C(u,"Display name: "),t=b(u,"P",{class:!0});var h=P(t);o=C(h,i),h.forEach(p),u.forEach(p),this.h()},h(){k(t,"class","text-aqua font-bold")},m(d,u){S(d,e,u),_(e,s),_(e,t),_(t,o)},p(d,u){u&2&&i!==(i=d[1].display_name+"")&&U(o,i)},d(d){d&&p(e)}}}function ne(f){let e;return{c(){e=E("Start new Pointing Session")},l(s){e=C(s,"Start new Pointing Session")},m(s,t){S(s,e,t)},d(s){s&&p(e)}}}function N(f){let e,s,t="Previous Sessions:",i,o,d,u="<div>Session ID</div> <div>Last Used</div>",h,m=H(f[2]),l=[];for(let r=0;r<m.length;r+=1)l[r]=T(M(f,m,r));return{c(){e=g("div"),s=g("h4"),s.textContent=t,i=D(),o=g("ul"),d=g("li"),d.innerHTML=u,h=D();for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=b(r,"DIV",{class:!0});var c=P(e);s=b(c,"H4",{class:!0,"data-svelte-h":!0}),w(s)!=="svelte-1r56ubk"&&(s.textContent=t),i=I(c),o=b(c,"UL",{});var n=P(o);d=b(n,"LI",{class:!0,"data-svelte-h":!0}),w(d)!=="svelte-1fipq7o"&&(d.innerHTML=u),h=I(n);for(let a=0;a<l.length;a+=1)l[a].l(n);n.forEach(p),c.forEach(p),this.h()},h(){k(s,"class","text-2xl font-bold"),k(d,"class","grid grid-cols-2"),k(e,"class","w-full")},m(r,c){S(r,e,c),_(e,s),_(e,i),_(e,o),_(o,d),_(o,h);for(let n=0;n<l.length;n+=1)l[n]&&l[n].m(o,null)},p(r,c){if(c&4){m=H(r[2]);let n;for(n=0;n<m.length;n+=1){const a=M(r,m,n);l[n]?l[n].p(a,c):(l[n]=T(a),l[n].c(),l[n].m(o,null))}for(;n<l.length;n+=1)l[n].d(1);l.length=m.length}},d(r){r&&p(e),W(l,r)}}}function T(f){let e,s,t,i=f[7].id+"",o,d,u,h=f[7].last_updated+"",m,l,r;return{c(){e=g("li"),s=g("a"),t=g("div"),o=E(i),d=D(),u=g("div"),m=E(h),r=D(),this.h()},l(c){e=b(c,"LI",{});var n=P(e);s=b(n,"A",{class:!0,href:!0});var a=P(s);t=b(a,"DIV",{});var y=P(t);o=C(y,i),y.forEach(p),d=I(a),u=b(a,"DIV",{});var v=P(u);m=C(v,h),v.forEach(p),a.forEach(p),r=I(n),n.forEach(p),this.h()},h(){k(s,"class","grid grid-cols-2 border border-1 rounded m-1 p-1"),k(s,"href",l="/points/"+f[7].id+"/")},m(c,n){S(c,e,n),_(e,s),_(s,t),_(t,o),_(s,d),_(s,u),_(u,m),_(e,r)},p(c,n){n&4&&i!==(i=c[7].id+"")&&U(o,i),n&4&&h!==(h=c[7].last_updated+"")&&U(m,h),n&4&&l!==(l="/points/"+c[7].id+"/")&&k(s,"href",l)},d(c){c&&p(e)}}}function le(f){let e,s,t=f[0].session&&A(f);return{c(){t&&t.c(),e=L()},l(i){t&&t.l(i),e=L()},m(i,o){t&&t.m(i,o),S(i,e,o),s=!0},p(i,[o]){i[0].session?t?(t.p(i,o),o&1&&x(t,1)):(t=A(i),t.c(),x(t,1),t.m(e.parentNode,e)):t&&(Z(),V(t,1,1,()=>{t=null}),K())},i(i){s||(x(t),s=!0)},o(i){V(t),s=!1},d(i){i&&p(e),t&&t.d(i)}}}function oe(f,e,s){let t,i;q(f,$,l=>s(1,t=l)),q(f,j,l=>s(2,i=l));let{data:o}=e,{supabase:d}=o;async function u(){const l={version:1,activePlayers:{}};d.from("PointingSession").insert({last_updated:new Date().toISOString(),game_state:l,users:[o.session.user.id]}).select().single().then(r=>{console.log("started new session",r),r.data&&B(`/points/${r.data.id}`)})}async function h(){const l=o.session?.user.id;if(console.log("Session:",o.session),console.log("User ID:",l),!l){console.error("No user ID found in session");return}const{data:r,error:c}=await d.from("profiles").select("*").eq("id",l).single();if(console.log("Profile fetch:",r,c),r){$.set(r);return}const{data:n,error:a}=await d.from("profiles").insert([{id:l,display_name:"default"}]).select().single();console.log("Profile insert:",n,a),n?$.set(n):(console.error("Profile creation error:",a),$.set({display_name:"default",temporary:!0,error:a?.message}))}async function m(){d.from("PointingSession").select().contains("users",[o.session?.user.id]).order("last_updated",{ascending:!1}).then(l=>{j.set(l.data)}),await h()}return O(async()=>{o.session||B("/auth")}),f.$$set=l=>{"data"in l&&s(0,o=l.data)},f.$$.update=()=>{f.$$.dirty&1&&({supabase:d}=o),f.$$.dirty&1&&o.session&&m()},[o,t,i,u]}class fe extends G{constructor(e){super(),J(this,e,oe,le,z,{data:0})}}export{fe as component};
