import{s as be,e as ie,o as ve,f as R,n as ye}from"../chunks/scheduler.XGLZWGdw.js";import{S as $e,i as ke,g as $,h as k,j as P,f as m,k as J,a as S,d as V,t as O,b as Z,s as M,m as D,r as ee,x as Pe,c as A,n as I,u as te,y as h,v as le,p as x,z as W,w as ae,e as ce,o as Q}from"../chunks/index.li6Z87Pf.js";import{e as G,B as ne,b as F,a as X}from"../chunks/button.Wg8vTYYf.js";import{g as Y}from"../chunks/navigation.f6KkA-yC.js";const Ve=({params:l})=>({slug:l.slug}),Ue=Object.freeze(Object.defineProperty({__proto__:null,load:Ve},Symbol.toStringTag,{value:"Module"}));function ue(l,e,a){const t=l.slice();return t[19]=e[a],t}function fe(l,e,a){const t=l.slice();return t[22]=e[a],t}function _e(l,e,a){const t=l.slice();return t[25]=e[a],t}function de(l){let e,a,t,n,r,c="Player Votes",u,f,b,v,C,q,H,T,N,w,B,L=G(l[5]),p=[];for(let o=0;o<L.length;o+=1)p[o]=he(_e(l,L,o));let j=G(l[6]),s=[];for(let o=0;o<j.length;o+=1)s[o]=me(fe(l,j,o));const z=o=>O(s[o],1,1,()=>{s[o]=null});let U=G(l[3]),d=[];for(let o=0;o<U.length;o+=1)d[o]=ge(ue(l,U,o));const pe=o=>O(d[o],1,1,()=>{d[o]=null});return w=new ne({props:{$$slots:{default:[Ne]},$$scope:{ctx:l}}}),w.$on("click",l[12]),{c(){e=$("div"),a=$("div"),t=$("h1"),n=$("h1"),r=$("h3"),r.textContent=c,u=M(),f=$("ol");for(let o=0;o<p.length;o+=1)p[o].c();b=M(),v=$("div"),C=D(`Select your pointing system:
				`),q=$("ul");for(let o=0;o<s.length;o+=1)s[o].c();H=M();for(let o=0;o<d.length;o+=1)d[o].c();T=M(),N=$("div"),ee(w.$$.fragment),this.h()},l(o){e=k(o,"DIV",{class:!0});var _=P(e);a=k(_,"DIV",{});var g=P(a);t=k(g,"H1",{class:!0});var i=P(t);n=k(i,"H1",{});var y=P(n);r=k(y,"H3",{class:!0,"data-svelte-h":!0}),Pe(r)!=="svelte-1vfpxjc"&&(r.textContent=c),u=A(y),f=k(y,"OL",{});var se=P(f);for(let E=0;E<p.length;E+=1)p[E].l(se);se.forEach(m),y.forEach(m),i.forEach(m),g.forEach(m),b=A(_),v=k(_,"DIV",{});var K=P(v);C=I(K,`Select your pointing system:
				`),q=k(K,"UL",{});var re=P(q);for(let E=0;E<s.length;E+=1)s[E].l(re);re.forEach(m),H=A(K);for(let E=0;E<d.length;E+=1)d[E].l(K);K.forEach(m),T=A(_),N=k(_,"DIV",{});var oe=P(N);te(w.$$.fragment,oe),oe.forEach(m),_.forEach(m),this.h()},h(){J(r,"class","font-bold text-2xl mb-2"),J(t,"class","text-3xl font-bold p-3"),J(e,"class","grid grid-cols-3")},m(o,_){S(o,e,_),h(e,a),h(a,t),h(t,n),h(n,r),h(n,u),h(n,f);for(let g=0;g<p.length;g+=1)p[g]&&p[g].m(f,null);h(e,b),h(e,v),h(v,C),h(v,q);for(let g=0;g<s.length;g+=1)s[g]&&s[g].m(q,null);h(v,H);for(let g=0;g<d.length;g+=1)d[g]&&d[g].m(v,null);h(e,T),h(e,N),le(w,N,null),B=!0},p(o,_){if(_&33){L=G(o[5]);let i;for(i=0;i<L.length;i+=1){const y=_e(o,L,i);p[i]?p[i].p(y,_):(p[i]=he(y),p[i].c(),p[i].m(f,null))}for(;i<p.length;i+=1)p[i].d(1);p.length=L.length}if(_&66){j=G(o[6]);let i;for(i=0;i<j.length;i+=1){const y=fe(o,j,i);s[i]?(s[i].p(y,_),V(s[i],1)):(s[i]=me(y),s[i].c(),V(s[i],1),s[i].m(q,null))}for(x(),i=j.length;i<s.length;i+=1)z(i);Z()}if(_&152){U=G(o[3]);let i;for(i=0;i<U.length;i+=1){const y=ue(o,U,i);d[i]?(d[i].p(y,_),V(d[i],1)):(d[i]=ge(y),d[i].c(),V(d[i],1),d[i].m(v,null))}for(x(),i=U.length;i<d.length;i+=1)pe(i);Z()}const g={};_&268435456&&(g.$$scope={dirty:_,ctx:o}),w.$set(g)},i(o){if(!B){for(let _=0;_<j.length;_+=1)V(s[_]);for(let _=0;_<U.length;_+=1)V(d[_]);V(w.$$.fragment,o),B=!0}},o(o){s=s.filter(Boolean);for(let _=0;_<s.length;_+=1)O(s[_]);d=d.filter(Boolean);for(let _=0;_<d.length;_+=1)O(d[_]);O(w.$$.fragment,o),B=!1},d(o){o&&m(e),W(p,o),W(s,o),W(d,o),ae(w)}}}function we(l){let e,a=l[25].displayName+"",t,n,r=l[25].currentVote+"",c;return{c(){e=$("li"),t=D(a),n=D(": "),c=D(r),this.h()},l(u){e=k(u,"LI",{class:!0});var f=P(e);t=I(f,a),n=I(f,": "),c=I(f,r),f.forEach(m),this.h()},h(){J(e,"class","text-lg")},m(u,f){S(u,e,f),h(e,t),h(e,n),h(e,c)},p(u,f){f&32&&a!==(a=u[25].displayName+"")&&Q(t,a),f&32&&r!==(r=u[25].currentVote+"")&&Q(c,r)},d(u){u&&m(e)}}}function Ee(l){let e,a=l[25].displayName+"",t,n,r=l[25].currentVote+"",c,u;return{c(){e=$("li"),t=D(a),n=D(": "),c=D(r),u=M(),this.h()},l(f){e=k(f,"LI",{class:!0});var b=P(e);t=I(b,a),n=I(b,": "),c=I(b,r),u=A(b),b.forEach(m),this.h()},h(){J(e,"class","text-lg font-bold text-lime-300")},m(f,b){S(f,e,b),h(e,t),h(e,n),h(e,c),h(e,u)},p(f,b){b&32&&a!==(a=f[25].displayName+"")&&Q(t,a),b&32&&r!==(r=f[25].currentVote+"")&&Q(c,r)},d(f){f&&m(e)}}}function he(l){let e;function a(r,c){return r[25].id===r[0].user.id?Ee:we}let t=a(l),n=t(l);return{c(){n.c(),e=ce()},l(r){n.l(r),e=ce()},m(r,c){n.m(r,c),S(r,e,c)},p(r,c){t===(t=a(r))&&n?n.p(r,c):(n.d(1),n=t(r),n&&(n.c(),n.m(e.parentNode,e)))},d(r){r&&m(e),n.d(r)}}}function De(l){let e=l[22]+"",a;return{c(){a=D(e)},l(t){a=I(t,e)},m(t,n){S(t,a,n)},p:ye,d(t){t&&m(a)}}}function me(l){let e,a,t,n;function r(){return l[10](l[22])}return a=new ne({props:{"aria-current":l[1]===l[22],"aria-label":l[22],selected:l[22]===l[1],$$slots:{default:[De]},$$scope:{ctx:l}}}),a.$on("click",r),{c(){e=$("li"),ee(a.$$.fragment),t=M()},l(c){e=k(c,"LI",{});var u=P(e);te(a.$$.fragment,u),t=A(u),u.forEach(m)},m(c,u){S(c,e,u),le(a,e,null),h(e,t),n=!0},p(c,u){l=c;const f={};u&2&&(f["aria-current"]=l[1]===l[22]),u&2&&(f.selected=l[22]===l[1]),u&268435456&&(f.$$scope={dirty:u,ctx:l}),a.$set(f)},i(c){n||(V(a.$$.fragment,c),n=!0)},o(c){O(a.$$.fragment,c),n=!1},d(c){c&&m(e),ae(a)}}}function Ie(l){let e=l[19]+"",a;return{c(){a=D(e)},l(t){a=I(t,e)},m(t,n){S(t,a,n)},p(t,n){n&8&&e!==(e=t[19]+"")&&Q(a,e)},d(t){t&&m(a)}}}function ge(l){let e,a;function t(){return l[11](l[19])}return e=new ne({props:{"aria-current":l[4]===l[19],"aria-label":l[19],selected:l[4]===l[19],$$slots:{default:[Ie]},$$scope:{ctx:l}}}),e.$on("click",t),{c(){ee(e.$$.fragment)},l(n){te(e.$$.fragment,n)},m(n,r){le(e,n,r),a=!0},p(n,r){l=n;const c={};r&24&&(c["aria-current"]=l[4]===l[19]),r&8&&(c["aria-label"]=l[19]),r&24&&(c.selected=l[4]===l[19]),r&268435464&&(c.$$scope={dirty:r,ctx:l}),e.$set(c)},i(n){a||(V(e.$$.fragment,n),a=!0)},o(n){O(e.$$.fragment,n),a=!1},d(n){ae(e,n)}}}function Ne(l){let e;return{c(){e=D("Clear Votes")},l(a){e=I(a,"Clear Votes")},m(a,t){S(a,e,t)},d(a){a&&m(e)}}}function je(l){let e,a,t=l[2]&&l[0]&&de(l);return{c(){e=$("div"),t&&t.c(),this.h()},l(n){e=k(n,"DIV",{class:!0});var r=P(e);t&&t.l(r),r.forEach(m),this.h()},h(){J(e,"class","text-yellow-100 p-8 h-full flex flex-col justify-center items-center")},m(n,r){S(n,e,r),t&&t.m(e,null),a=!0},p(n,[r]){n[2]&&n[0]?t?(t.p(n,r),r&5&&V(t,1)):(t=de(n),t.c(),V(t,1),t.m(e,null)):t&&(x(),O(t,1,1,()=>{t=null}),Z())},i(n){a||(V(t),a=!0)},o(n){O(t),a=!1},d(n){n&&m(e),t&&t.d()}}}function Oe(){return new Date().toISOString()}function Se(l,e,a){let t,n;ie(l,F,s=>a(2,t=s)),ie(l,X,s=>a(15,n=s));let{data:r}=e,{supabase:c,session:u}=r,f=[];const b=["Fibonacci"];let v=b[0],C;async function q(s){s.new.last_updated>t.last_updated&&(console.debug("syncPointingSession",s),F.set(s.new))}async function H(s){a(4,C=s),R(F,t.game_state.activePlayers[u.user.id].currentVote=C,t),R(F,t.game_state.activePlayers[u.user.id].displayName=n.display_name,t),R(F,t.game_state.last_updated=Oe(),t),await N()}async function T(){a(4,C=""),Object.entries(t.game_state.activePlayers).forEach(([s,z])=>(z.currentVote="",z)),await N()}async function N(){await c.from("PointingSession").update({game_state:t.game_state,last_updated:t.last_updated}).eq("id",t.id).select().single().then(s=>{s.data&&(F.set(s.data),console.log("synced game state",s)),s.error&&console.error("error updating game state",s.error)})}async function w(){await c.from("profiles").select("*").eq("id",u.user.id).limit(1).single().then(s=>{s?.data?X.set(s.data):X.set({display_name:"default",temporary:!0})}),await c.from("PointingSession").select("*").eq("id",r.slug).single().then(s=>{console.log("Got the pointing session",s),s.data?(c.channel(`${r.slug}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"PointingSession",filter:`id=eq.${s.data.id}`},z=>q(z)).subscribe(),Object.hasOwn(s.data.game_state.activePlayers,u.user.id)?(console.log("syncing display name"),s.data.game_state.activePlayers[u.user.id]={...s.data.game_state.activePlayers[u.user.id],displayName:n.display_name}):s.data.game_state.activePlayers[u.user.id]={currentVote:"",id:u.user.id,displayName:n.display_name},F.set(s.data),N()):Y("/")})}let B=[];ve(async()=>{r.slug||Y("/"),console.log("sessions",u),u||Y(`/auth?next=${location}`)});const L=s=>a(1,v=s),p=s=>H(s),j=()=>T();return l.$$set=s=>{"data"in s&&a(9,r=s.data)},l.$$.update=()=>{l.$$.dirty&512&&a(0,{supabase:c,session:u}=r,u),l.$$.dirty&1&&u&&w(),l.$$.dirty&4&&t&&t?.game_state?.activePlayers&&a(5,B=Object.values(t.game_state.activePlayers)),l.$$.dirty&2&&v&&a(3,f={Fibonacci:{name:"Fibonacci",numbers:[1,2,3,5,8]}}[v].numbers)},[u,v,t,f,C,B,b,H,T,r,L,p,j]}class Fe extends $e{constructor(e){super(),ke(this,e,Se,je,be,{data:9})}}export{Fe as component,Ue as universal};
